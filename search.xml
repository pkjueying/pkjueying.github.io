<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
    
    <entry>
      <title><![CDATA[罗马人的故事01]]></title>
      <url>https://github.com/pkjueying/pkjueying.github.io/2016/05/18/%E7%BD%97%E9%A9%AC%E4%BA%BA%E7%9A%84%E6%95%85%E4%BA%8B01/</url>
      <content type="html"></content>
    </entry>
    
    <entry>
      <title><![CDATA[每天随记]]></title>
      <url>https://github.com/pkjueying/pkjueying.github.io/2016/05/17/thingking-everyday/</url>
      <content type="html"><![CDATA[<h1 id="Who"><a href="#Who" class="headerlink" title="Who"></a>Who</h1><p>who am I?</p>
<h1 id="Hello"><a href="#Hello" class="headerlink" title="Hello"></a>Hello</h1><p>hello, It’s me.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[binder简要学习]]></title>
      <url>https://github.com/pkjueying/pkjueying.github.io/2016/03/17/binder01/</url>
      <content type="html"><![CDATA[<h1 id="Binder"><a href="#Binder" class="headerlink" title="Binder"></a>Binder</h1><h3 id="本文目标"><a href="#本文目标" class="headerlink" title="本文目标"></a>本文目标</h3><p>理解Binder对于理解整个Android系统有着非常重要的作用，Android系统的四大组件，AMS，PMS等系统服务无一不与Binder挂钩；如果对Binder不甚了解，那么就很难了解这些系统机制.</p>
<p>要真正的弄明白 Binder机制 还是比较麻烦的，我们今天只是大致的介绍一下在应用层怎么使用</p>
<p>本文目标:</p>
<ul>
<li><p>不依赖AIDL工具，手写远程Service完成跨进程通信</p>
</li>
<li><p>弄明白AIDL生成的相关代码</p>
</li>
<li><p>以及基于AIDL代码的分析，了解系统相关服务的代码逻辑.</p>
</li>
</ul>
<h3 id="Linux相关概念"><a href="#Linux相关概念" class="headerlink" title="Linux相关概念"></a>Linux相关概念</h3><p>因为是讲进程间的通信，而android又是基于linux，所以对于linux系统需要一定的了解.<br>推荐 <a href="https://book.douban.com/subject/1503819/" target="_blank" rel="external">linux内核设计与实现</a> 其主要是讲一些系统概念</p>
<ul>
<li><p>操作系统的不同进程之间，数据不共享；对于每个进程来说，都以为自己独享了整个系统，完全不知道其他进程的存在；因此一个进程需要与另外一个进程通信，需要某种 <strong>系统机制</strong> 才能完成。</p>
</li>
<li><p>用户程序只可以访问某些许可的资源，不许可的资源是拒绝被访问的，于是认为的就把Kernel和上层的应用程序抽像的隔离开，分别称之为 <strong>内核空间(Kernel Space)</strong> 和 <strong>用户空间(User Space)</strong> .</p>
</li>
<li><p>用户空间访问内核空间的唯一方式就是 <strong>系统调用</strong> ；通过这个统一入口，所有的资源访问都是在内核的控制下执行，以免导致用户程序对系统资源的越权访问，从而保障了系统的安全和稳定.</p>
</li>
<li><p>当一个任务（进程）执行系统调用而陷入内核代码中执行时，我们就称进程处于 <strong>内核运行态</strong> 此时处理器处于特权级最高的内核代码中执行。当进程在执行用户自己的代码时，则称其处于 <strong>用户运行态</strong>（用户态）。处理器在特权等级高的时候才能执行那些特权CPU指令。</p>
</li>
<li><p>通过系统调用，用户空间可以访问内核空间. 如果一个用户空间想与另外一个用户空间进行通信，一般是需要操作系统内核添加支持. </p>
</li>
<li><p>Linux有个比较好的机制，就是可以 <strong>动态加载内核模块</strong> ；<strong>模块</strong> 是具有独立功能的程序，它可以被单独编译，但不能独立运行。它在运行时被链接到内核作为内核的一部分在内核空间运行。</p>
<p>  这样，Android系统就可以在Linux的基础之上，通过添加一个内核模块运行在内核空间，用户进程之间可通过这个模块完成通信。这个模块就是所谓的 <strong>Binder驱动</strong> .</p>
<p>  尽管名叫‘驱动’，实际上和硬件设备没有任何关系，只是实现方式和设备驱动程序是一样的：它工作于内核态，提供open()，mmap()，poll()，ioctl()等标准文件设备的操作.</p>
</li>
<li><p>Linux已拥有的进程间通信IPC手段包括： Pipe、Signal、Socket、Message、Share Memory 和信号量Semaphore.</p>
</li>
</ul>
<h3 id="为何使用Binder"><a href="#为何使用Binder" class="headerlink" title="为何使用Binder"></a>为何使用Binder</h3><p>为什么要单独弄一套， 而不是使用linux系统提供的那些进程间通信的方式</p>
<p>主要是考虑到性能和安全，还有易用. </p>
<ul>
<li><p>最易想到的就是利用存储-转发机制：使用Linux 提供的系统调用接口：copy_from_user()和copy_to_user() 来实现进程间通信，缺点是效率低下，需要做两次拷贝：用户空间-&gt;内核空间-&gt;用户空间。</p>
</li>
<li><p>Binder驱动 为了实现用户空间到用户空间的拷贝，mmap()分配的内存除了映射进了接收方进程里，还映射进了内核空间。所以调用copy_from_user()将数据拷贝进内核空间也相当于拷贝进了接收方的用户空间， 所以Binder机制只需要一次拷贝。</p>
</li>
<li><p>而共享内存的话，效率比较高， 但控制复杂….</p>
</li>
<li><p>安全性: 传统IPC没有任何安全措施，完全依赖上层协议来确保；传统IPC访问接入点是开放的，无法建立私有通道；例如Socket通信的话，socket的ip地址或文件名都是开放的，只要知道这些接入点的程序都可以和对端建立连接，不管怎样都无法阻止恶意程序通过猜测接收方地址获得连接。</p>
</li>
</ul>
<blockquote>
<p>Binder基于Client-Server通信模式，传输过程只需一次拷贝，为发送发添加UID/PID身份，既支持实名Binder也支持匿名Binder，安全性高。</p>
</blockquote>
<h3 id="Binder通信模型"><a href="#Binder通信模型" class="headerlink" title="Binder通信模型"></a>Binder通信模型</h3><p>应用层大家所熟知的通信结构， 如下图:</p>
<p><img src="/img/binder/binder通信概述.jpg" alt="Binder通信概述"></p>
<ol>
<li>从表面上来看，是client通过获得一个server的代理接口，对server进行直接调用；</li>
<li>实际上，代理接口中定义的方法与server中定义的方法是一一对应的；</li>
<li>client调用某个代理接口中的方法时，代理接口的方法会将client传递的参数打包成为Parcel对象；</li>
<li>代理接口将该Parcel发送给内核中的binder driver.</li>
<li>server会读取binder driver中的请求数据，如果是发送给自己的，解包Parcel对象，处理并将结果返回；</li>
<li>整个的调用过程是一个同步过程，在server处理的时候，client会block住。</li>
</ol>
<p>在整个Binder系统中，Binder框架定义了四个角色：Server，Client，ServiceManager 以及Binder驱动。其中Server，Client，SM运行于用户空间，驱动运行于内核空间</p>
<p><img src="/img/binder/binder-通信模型.jpg" alt="Binder通信模型"></p>
<p>整个步骤如下: </p>
<ul>
<li><p>SM建立；首先有一个进程向驱动提出申请为SM；驱动同意之后，SM进程负责管理Service.</p>
</li>
<li><p>各个Server向SM注册；将Server自己的名字和内存地址报告给SM; 这样SM就建立了一张表，对应着各个Server的名字和地址</p>
</li>
<li><p>Client想要与Server通信，首先询问SM；通过服务名获取到对应的内存地址；Client收到之后，就可以进行通信了.</p>
<p>  可以看出驱动是整个通信过程的核心，完成跨进程通信的秘密全部隐藏在驱动里面；这里Client与SM的通信，以及Client与Server的通信，都会经过驱动</p>
</li>
</ul>
<blockquote>
<p>相关接口可参见 native/libs/binder/IServiceManager.cpp  以及对应的native 层 service_manager.c</p>
</blockquote>
<h3 id="Binder机制跨进程原理"><a href="#Binder机制跨进程原理" class="headerlink" title="Binder机制跨进程原理"></a>Binder机制跨进程原理</h3><p><img src="/img/binder/binder-跨进程原理.jpg" alt="Binder机制跨进程原理"></p>
<ul>
<li><p>首先，Server进程要向SM注册；告诉自己是谁，自己有什么能力;在这个场景就是Server告诉SM，它叫AAA，它有一个object对象，可以执行add 操作；于是SM建立了一张表：AAA这个名字对应进程Server; 如原代码中 .//native/libs/binder/IServiceManager.cpp</p>
<pre><code>virtual status_t addService(const String16&amp; name, const sp&lt;IBinder&gt;&amp; service,
    bool allowIsolated)
{
    Parcel data, reply;
data.writeInterfaceToken(IServiceManager::getInterfaceDescriptor());
    data.writeString16(name);
    data.writeStrongBinder(service);
    data.writeInt32(allowIsolated ? 1 : 0);
    status_t err = remote()-&gt;transact(ADD_SERVICE_TRANSACTION, data, &amp;reply);
    return err == NO_ERROR ? reply.readExceptionCode() : err;
}
</code></pre></li>
<li><p>然后Client向SM查询：名字叫做AAA的进程里面的object对象；进程之间通信的数据都会经过运行在内核空间里面的驱动，驱动在数据流过的时候会做一些处理，它并不会给Client进程返回一个真正的object对象，而是返回一个看起来跟object一模一样的代理对象objectProxy，这个objectProxy也有一个add方法，但是这个add方法没有Server进程里面object对象的add方法那个能力；它唯一做的事情就是把参数包装然后交给驱动。</p>
</li>
<li><p>驱动收到这个消息，发现是这个objectProxy；通过查表就知道：之前用objectProxy替换了object发送给Client了，它真正应该要访问的是object对象的add方法；于是Binder驱动通知Server进程，调用它的object对象的add方法，然后把结果发给binder驱动，Sever进程收到这个消息，执行add之后将结果返回驱动，驱动然后把结果返回给Client进程；于是整个过程就完成了.</p>
</li>
</ul>
<p>Binder跨进程传输并不是真的把一个对象传输到了另外一个进程；传输过程是在Binder跨进程穿越的时候，它在一个进程留下了一个本体，在另外一个进程则使用该对象的一个proxy；Client进程的操作其实是对于proxy的操作，proxy利用Binder驱动最终让真正的binder对象完成操作。</p>
<p>Android系统实现这种机制使用的是代理模式, 对于Binder的访问，如果是在同一个进程，那么直接返回原始的Binder实体；如果在不同进程，那么就给他一个代理对象- 在后面的demo中我们可以看见…</p>
<pre><code>public static ICalculate asInterface(IBinder obj) {
        if(obj == null) {
            return null;
        } else {
            IInterface iin = obj.queryLocalInterface(&quot;com.zhangfl.jpush.ICalculate&quot;);
            return (ICalculate)(iin != null &amp;&amp; iin instanceof ICalculate?(ICalculate)iin:new ICalculate.Stub.Proxy(obj));
        }
    }
</code></pre><blockquote>
<p>Client进程只不过是持有了Server端的代理；代理对象协助驱动完成了跨进程通信。</p>
</blockquote>
<h3 id="proxy代理模式"><a href="#proxy代理模式" class="headerlink" title="proxy代理模式"></a>proxy代理模式</h3><p>模式中的三种角色:</p>
<p><img src="/img/binder/proxy_uml.jpg" alt="proxy设计模式"></p>
<ul>
<li><p>抽象角色：声明真实对象和代理对象的共同接口。</p>
</li>
<li><p>代理角色：代理对象角色内部含有对真实对象的引用，从而可以操作真实对象，同时代理对象提供与真实对象相同的接口以便在任何时刻都能代替真实对象。同时，代理对象可以在执行真实对象操作时，附加其他的操作，相当于对真实对象进行封装。</p>
</li>
<li><p>真实角色：代理角色所代表的真实对象，是我们最终要引用的对象。</p>
</li>
</ul>
<blockquote>
<p>模式原则: 对修改关闭，对扩展开放，保证了系统的稳定性</p>
</blockquote>
<h3 id="驱动里面的Binder"><a href="#驱动里面的Binder" class="headerlink" title="驱动里面的Binder"></a>驱动里面的Binder</h3><p>略过:  具体可以参考源码以及 <a href="http://blog.csdn.net/universus/article/details/6211589" target="_blank" rel="external">Binder设计与实现</a> 一文</p>
<h3 id="Java层的Binder"><a href="#Java层的Binder" class="headerlink" title="Java层的Binder"></a>Java层的Binder</h3><p>IBinder/IInterface/Binder/BinderProxy/Stub</p>
<ul>
<li><p>IBinder是一个接口，它代表了一种跨进程传输的能力；只要实现了这个接口，就能将这个对象进行跨进程传递；这是驱动底层支持的；在跨进程数据流经驱动的时候，驱动会识别IBinder类型的数据，从而自动完成不同进程Binder本地对象以及Binder代理对象的转换。</p>
</li>
<li><p>IInterface代表的就是远程server对象具有的能力。具体来说，就是aidl里面的接口。</p>
</li>
<li><p>Java层的Binder类，代表的其实就是Binder本地对象。BinderProxy类是Binder类的一个内部类，它代表远程进程的Binder对象的本地代理；这两个类都继承自IBinder, 因而都具有跨进程传输的能力；实际上，在跨越进程的时候，Binder驱动会自动完成这两个对象的转换。</p>
</li>
<li><p>在使用AIDL的时候，编译工具会给我们生成一个Stub的静态内部类；这个类继承了Binder, 说明它是一个Binder本地对象，它实现了IInterface接口，表明它具有远程Server承诺给Client的能力；Stub是一个抽象类，具体的IInterface的相关实现需要我们手动完成. 其实这里使用了策略模式.</p>
</li>
</ul>
<h3 id="AIDL过程分析"><a href="#AIDL过程分析" class="headerlink" title="AIDL过程分析"></a>AIDL过程分析</h3><p>一种固定的模式：</p>
<ul>
<li>一个需要跨进程传递的对象一定继承自IBinder，如果是Binder本地对象，那么一定继承Binder实现IInterface，如果是代理对象，那么就实现了IInterface并持有IBinder引用；</li>
</ul>
<p>Proxy与Stub不一样，虽然他们都既是Binder又是IInterface，不同的是Stub采用的是继承（is 关系），Proxy采用的是组合（has 关系）。他们均实现了所有的IInterface函数，不同的是，Stub使用策略模式调用的是虚函数（待子类实现），而Proxy则使用组合模式。为什么Stub采用继承而Proxy采用组合？事实上，Stub本身is一个IBinder（Binder），它本身就是一个能跨越进程边界传输的对象，所以它得继承IBinder实现transact这个函数从而得到跨越进程的能力（这个能力由驱动赋予）。Proxy类使用组合，是因为他不关心自己是什么，它也不需要跨越进程传输，它只需要拥有这个能力即可，要拥有这个能力，只需要保留一个对IBinder的引用</p>
<h3 id="demo"><a href="#demo" class="headerlink" title="demo."></a>demo.</h3><p>……</p>
<h3 id="系统服务分析"><a href="#系统服务分析" class="headerlink" title="系统服务分析"></a>系统服务分析</h3><p>IXXX、IXXX.Stub和IXXX.Stub.Proxy，并做好对应。这样看相关的系统服务就比较容易了，以ServiceManager为例</p>
<p>实际上ServerManager既是系统服务的管理者，同时也是一个系统服务。因此它肯定是基于Binder实现的</p>
<ul>
<li><p>与IXXX相对应的类就是IServiceManager类，封装了远程调用的几个主要函数</p>
</li>
<li><p>与IXXX.Stub对应的类就是ServiceManagerNative</p>
</li>
<li><p>与IXXX.Stub.Proxy对应的类ServiceManagerProxy</p>
<p>  查看上面相关类的代码，实际上和使用adil生成的代码没什么两样。仅仅是类命名不一样，将三个类分开写了而已。</p>
<p>  在服务端继承ServiceManagerNative类实现里面的相关方法就能实现服务端，然后在客户端将远程服务端所对应的的Binder封装成：</p>
<p>  IServiceManager iSm = ServiceManagerNative.asInterface(binder)即可</p>
<p>  PS： 实际上，在源码中找不到继承自ServiceManagerNative类的远程服务端类ServiceManagerService，根本就找不到这样一个类。原因是SMS在native层被实现成一个独立的进程，是在启动后解析init.rc脚本启动服务的.</p>
</li>
</ul>
<p>再看看ActivityManager中的Binder。</p>
<ul>
<li><p>IActivityManager对应IXXX接口</p>
</li>
<li><p>ActivityManagerNative对应IXXX.Stub类，继承自Binder类。</p>
</li>
<li><p>ActivityManagerProxy对应IXXX.Stub.Proxy类。</p>
<p>  AMS的服务端就是ActivityManagerService类，这个类继承自ActivityManagerNative，实现了IActivityManager接口中的方法用来进行IPC。</p>
<p>  只要在客户端得到了这个远程服务端的Binder引用就可以进行IPC通信了</p>
</li>
</ul>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><ul>
<li><p><a href="https://book.douban.com/subject/1503819/" target="_blank" rel="external">linux内核设计与实现</a></p>
</li>
<li><p><a href="http://blog.csdn.net/universus/article/details/6211589" target="_blank" rel="external">Binder设计与实现</a></p>
</li>
<li><p><a href="http://blog.csdn.net/luoshengyang/article/details/6618363" target="_blank" rel="external">Android进程间通信（IPC）机制Binder简要介绍和学习计划系列</a></p>
</li>
</ul>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[ android4.2 开机动画跟踪]]></title>
      <url>https://github.com/pkjueying/pkjueying.github.io/2014/04/11/Android-%E5%BC%80%E6%9C%BA%E5%8A%A8%E7%94%BB%E8%B7%9F%E8%B8%AA/</url>
      <content type="html"><![CDATA[<blockquote>
<p>Android4.2 源码， UnderStand源码阅读</p>
</blockquote>
<p>Android系统开机过程中主要会出现3个动画：</p>
<ol>
<li>Linux系统启动（默认不出现）</li>
<li>Android平台启动初始化(默认出现“ANDROID的字样”)</li>
<li>ANDROID平台图形系统启动（默认出现含ANDROID字样的闪动动画图片）</li>
</ol>
<p>下面我们一一来进行跟踪。</p>
<p>首先关于Linux的开机图画在/home2/zfl/a20-4.2/lichee_zfl/linux-3.3/drivers/video/logo/logo.c中。Linux kernel引导启动后，加载该图片。logo.c中定义了nologo,然后在linux_logo * __init_refok fb_find_logo(int depth)方法中根据nologo 来进行判断是否进行显示相关图画。具体相关代码如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">bool</span> nologo;</span><br><span class="line">module_param(nologo, <span class="keyword">bool</span>, <span class="number">0</span>);</span><br><span class="line">MODULE_PARM_DESC(nologo, <span class="string">"Disables startup logo"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* logo's are marked __initdata. Use __init_refok to tell</span><br><span class="line"> * modpost that it is intended that this function uses data</span><br><span class="line"> * marked __initdata.</span><br><span class="line"> */</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">struct</span> linux_logo * __<span class="function">init_refok <span class="title">fb_find_logo</span><span class="params">(<span class="keyword">int</span> depth)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">struct</span> linux_logo *logo = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (nologo)</span><br><span class="line">                return <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (depth &gt;= <span class="number">1</span>) &#123;</span><br><span class="line">		\<span class="meta">#<span class="meta-keyword">ifdef</span> CONFIG_LOGO_LINUX_MONO</span></span><br><span class="line">                <span class="comment">/* Generic Linux logo */</span></span><br><span class="line">                logo = &amp;logo_linux_mono;</span><br><span class="line"></span><br><span class="line">		...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来进行开机“ANDROID”字样的跟踪：</p>
<p>ANDROID系统启动后，在/home2/zfl/a20-4.2/android/system/core/init/init.c 中有</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">console_init_action</span><span class="params">(<span class="keyword">int</span> nargs, <span class="keyword">char</span> **args)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> fd;</span><br><span class="line">    <span class="keyword">char</span> tmp[PROP_VALUE_MAX];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (console[<span class="number">0</span>]) &#123;</span><br><span class="line">        <span class="built_in">snprintf</span>(tmp, <span class="keyword">sizeof</span>(tmp), <span class="string">"/dev/%s"</span>, console);</span><br><span class="line">        console_name = strdup(tmp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fd = open(console_name, O_RDWR);</span><br><span class="line">    <span class="keyword">if</span> (fd &gt;= <span class="number">0</span>)</span><br><span class="line">        have_console = <span class="number">1</span>;</span><br><span class="line">    close(fd);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//if( load_565rle_image(INIT_IMAGE_FILE) ) &#123;</span></span><br><span class="line">    <span class="keyword">if</span>( load_argb8888_image(INIT_IMAGE_FILE) ) &#123;</span><br><span class="line">        fd = open(<span class="string">"/dev/tty0"</span>, O_WRONLY);</span><br><span class="line">        <span class="keyword">if</span> (fd &gt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">const</span> <span class="keyword">char</span> *msg;</span><br><span class="line">                msg = <span class="string">"\n"</span></span><br><span class="line">            <span class="string">"\n"</span></span><br><span class="line">            <span class="string">"\n"</span></span><br><span class="line">            <span class="string">"\n"</span></span><br><span class="line">            <span class="string">"\n"</span></span><br><span class="line">            <span class="string">"\n"</span></span><br><span class="line">            <span class="string">"\n"</span>  <span class="comment">// console is 40 cols x 30 lines</span></span><br><span class="line">            <span class="string">"\n"</span></span><br><span class="line">            <span class="string">"\n"</span></span><br><span class="line">            <span class="string">"\n"</span></span><br><span class="line">            <span class="string">"\n"</span></span><br><span class="line">            <span class="string">"\n"</span></span><br><span class="line">            <span class="string">"\n"</span></span><br><span class="line">            <span class="string">"\n"</span></span><br><span class="line">            <span class="string">"             A N D R O I D "</span>;</span><br><span class="line">            write(fd, msg, <span class="built_in">strlen</span>(msg));</span><br><span class="line">            close(fd);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而在main()中有相关的调用：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">/* skip mounting filesystems in charger mode */</span></span><br><span class="line">  <span class="keyword">if</span> (!is_charger) &#123;</span><br><span class="line">      action_for_each_trigger(<span class="string">"early-fs"</span>, action_add_queue_tail);</span><br><span class="line">      queue_builtin_action(console_init_action, <span class="string">"console_init"</span>);</span><br><span class="line">      action_for_each_trigger(<span class="string">"fs"</span>, action_add_queue_tail);</span><br><span class="line">      action_for_each_trigger(<span class="string">"post-fs"</span>, action_add_queue_tail);</span><br><span class="line">      action_for_each_trigger(<span class="string">"post-fs-data"</span>, action_add_queue_tail);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<p>上述中的INIT_IMAGE_FILE 在init.h中有相关定义：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">\<span class="meta">#<span class="meta-keyword">define</span> INIT_IMAGE_FILE <span class="string">"/initlogo.rle"</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">load_565rle_image</span><span class="params">( <span class="keyword">char</span> *file_name )</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">load_argb8888_image</span><span class="params">(<span class="keyword">char</span> *fn)</span></span>;</span><br></pre></td></tr></table></figure>
<p>接下来进行最后的开机动画即闪动的ANDROID字样的跟踪</p>
<p>在ANDROID4.2中，ANDROID的系统登录动画由前景和背景两站PNG图片组成，在我的系统中，这两张图片位于 /home2/zfl/a20-4.2/android/frameworks/base/core/res/assets/images  如图：</p>
<p><img src="/img/animate/20130624115253140.png" alt=""></p>
<p>前景图片（android-logo-mask.png）中的ANDROID文字部分镂空，如图:</p>
<p><img src="/img/animate/20130624115441921.png" alt=""></p>
<p>背景图片则是简单的纹理，如图：</p>
<p><img src="/img/animate/20130624115540296.png" alt=""></p>
<p>前景图片在最上层显示，程序代码控制背景图片的连续滚动，透过前景图片文字镂空部分进行滚动进而显示纹理，从而显示动画效果。<br>其相关的代码在：</p>
<p>/home2/zfl/a20-4.2/android/frameworks/base/cmds/bootanimation/BootAnimation.cpp</p>
<p>/home2/zfl/a20-4.2/android/frameworks/base/include/androidfw/AssetManager.h</p>
<p>/home2/zfl/a20-4.2/android/frameworks/base/include/androidfw/Asset.h</p>
<p>………………………..待</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[Android 启动过程代码跟踪]]></title>
      <url>https://github.com/pkjueying/pkjueying.github.io/2014/03/10/Android-%E5%90%AF%E5%8A%A8%E8%BF%87%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%B7%9F%E8%B8%AA/</url>
      <content type="html"><![CDATA[<blockquote>
<p>准备工作：Android源码，UnderStand源码阅读工具</p>
</blockquote>
<p>我们知道Android系统在启动时首先会启动Linux系统，引导加载Linux Kernel并启动init进程。Init进程是一个由内核启动的用户级进程，是Android系统的第一个进程。该进程的相关代码在android/system/core/init/init.c。在main函数中，有如下代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">init_parse_config_file(<span class="string">"/init.rc"</span>);</span><br><span class="line"></span><br><span class="line"> action_for_each_trigger(<span class="string">"early-init"</span>, action_add_queue_tail);</span><br><span class="line"></span><br><span class="line"> ......</span><br><span class="line"></span><br><span class="line"> <span class="comment">/* execute all the boot actions to get us started */</span></span><br><span class="line"> action_for_each_trigger(<span class="string">"init"</span>, action_add_queue_tail);</span><br><span class="line"></span><br><span class="line"> <span class="comment">/* skip mounting filesystems in charger mode */</span></span><br><span class="line"> <span class="keyword">if</span> (!is_charger) &#123;</span><br><span class="line">     action_for_each_trigger(<span class="string">"early-fs"</span>, action_add_queue_tail);</span><br><span class="line">     action_for_each_trigger(<span class="string">"fs"</span>, action_add_queue_tail);</span><br><span class="line">     action_for_each_trigger(<span class="string">"post-fs"</span>, action_add_queue_tail);</span><br><span class="line">     action_for_each_trigger(<span class="string">"post-fs-data"</span>, action_add_queue_tail);</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> .......</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> (is_charger) &#123;</span><br><span class="line">     action_for_each_trigger(<span class="string">"charger"</span>, action_add_queue_tail);</span><br><span class="line"> &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">     action_for_each_trigger(<span class="string">"early-boot"</span>, action_add_queue_tail);</span><br><span class="line">     action_for_each_trigger(<span class="string">"boot"</span>, action_add_queue_tail);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>这里会加载init.rc并进行解析，init.rc文件定义了在init进程中需要启动哪些进程服务和执行哪些动作。其详细说明参见android/system/core/init/reademe.txt。init.rc见如下定义：</p>
<p>……<br>service servicemanager /system/bin/servicemanager<br>    class core<br>    user system<br>    group system<br>    critical<br>    onrestart restart zygote<br>    onrestart restart media<br>    onrestart restart surfaceflinger<br>    onrestart restart drm</p>
<p>service vold /system/bin/vold<br>    class core<br>    socket vold stream 0660 root mount<br>    ioprio be 2</p>
<p>……..</p>
<p>service zygote /system/bin/app_process -Xzygote /system/bin –zygote –start-system-server<br>    class main<br>    socket zygote stream 660 root system<br>    onrestart write /sys/android_power/request_state wake<br>    onrestart write /sys/power/state on<br>    onrestart restart media<br>    onrestart restart netd</p>
<p>service drm /system/bin/drmserver<br>    class main<br>    user drm<br>    group drm system inet drmrpc sdcard_r</p>
<p>service media /system/bin/mediaserver<br>    class main</p>
<p>……….</p>
<p>具体解析过程见android/system/core/init/Init_parser.c。解析所得服务添加到service_list中，动作添加到action_list中。主要代码流程如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">for</span> (;;) &#123;</span><br><span class="line">        <span class="keyword">switch</span> (next_token(&amp;state)) &#123;</span><br><span class="line">        <span class="keyword">case</span> T_EOF:</span><br><span class="line">            state.parse_line(&amp;state, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">            <span class="keyword">goto</span> parser_done;</span><br><span class="line">        <span class="keyword">case</span> T_NEWLINE:</span><br><span class="line">            state.line++;</span><br><span class="line">            <span class="keyword">if</span> (nargs) &#123;</span><br><span class="line">                <span class="keyword">int</span> kw = lookup_keyword(args[<span class="number">0</span>]);</span><br><span class="line">                <span class="keyword">if</span> (kw_is(kw, SECTION)) &#123;</span><br><span class="line">                    state.parse_line(&amp;state, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">                    parse_new_section(&amp;state, kw, nargs, args);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    state.parse_line(&amp;state, nargs, args);</span><br><span class="line">                &#125;</span><br><span class="line">                nargs = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> T_TEXT:</span><br><span class="line">            <span class="keyword">if</span> (nargs &lt; INIT_PARSER_MAXARGS) &#123;</span><br><span class="line">                args[nargs++] = state.text;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">parser_done:</span><br><span class="line">    list_for_each(node, &amp;import_list) &#123;</span><br><span class="line">         <span class="keyword">struct</span> import *import = node_to_item(node, struct import, list);</span><br><span class="line">         <span class="keyword">int</span> ret;</span><br><span class="line"></span><br><span class="line">         INFO(<span class="string">"importing '%s'"</span>, import-&gt;filename);</span><br><span class="line">         ret = init_parse_config_file(import-&gt;filename);</span><br><span class="line">         <span class="keyword">if</span> (ret)</span><br><span class="line">             ERROR(<span class="string">"could not import file '%s' from '%s'\n"</span>,</span><br><span class="line">                   import-&gt;filename, fn);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>接下来在main函数中执行动作和启动进程服务：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">for</span>(; ;) &#123;</span><br><span class="line">......</span><br><span class="line">execute_one_command();</span><br><span class="line">        restart_processes();</span><br><span class="line">......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>通常init过程需要创建一些系统文件夹并启动USB守护进程、Android Debug Bridge守护进程、Debug守护进程、ServiceManager进程、Zygote进程等。</p>
<p>由init.rc对ServiceManager的描述service servicemanager /system/bin/servicemanager可知servicemanager进程从platform\frameworks\base\cmd\servicemanager\Service_manager.cpp启动。在main函数中有如下代码：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    <span class="keyword">struct</span> binder_state *bs;</span><br><span class="line">    <span class="keyword">void</span> *svcmgr = BINDER_SERVICE_MANAGER;</span><br><span class="line"></span><br><span class="line">    bs = binder_open(<span class="number">128</span>*<span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (binder_become_context_manager(bs)) &#123;</span><br><span class="line">        ALOGE(<span class="string">"cannot become context manager (%s)\n"</span>, strerror(errno));</span><br><span class="line">        return <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    svcmgr_handle = svcmgr;</span><br><span class="line">    binder_loop(bs, svcmgr_handler);</span><br><span class="line">    return <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>而在android/framework/base/cmd/servicemanager/Binder.c中<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">binder_become_context_manager</span><span class="params">(<span class="keyword">struct</span> binder_state *bs)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">    return ioctl(bs-&gt;fd, BINDER_SET_CONTEXT_MGR, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>以上首先调用binder_open()打开Binder设备(/dev/binder)，调用binder_become_context_manager()把当前进程设置为ServiceManager。ServiceManager本身就是一个服务。最后binder_loop()进入循环状态，并设置svcmgr_handler回调函数等待添加、查询、获取服务等请求。</p>
<p>在启动servicemanager的同时，再来启动Zygote，由init.rc对zygote的描述service zygot /system/bin/app_process可知zygote进程从Android\frameworks\base\cmds\app_process\App_main.cpp启动。这个文件的main（）方法，会调用Android_Runtime.cpp的文件中的start（）方法，这个方法通过JNI机制，来调用ZygoteInit.java孵化器初始文件，这个文件的Main（）函数，将会去调用所有进程。其主要代码如下:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">......</span><br><span class="line"><span class="keyword">while</span> (i &lt; argc) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span>* arg = argv[i++];</span><br><span class="line">        <span class="keyword">if</span> (!parentDir) &#123;</span><br><span class="line">            parentDir = arg;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strcmp(arg, <span class="string">"--zygote"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            zygote = <span class="literal">true</span>;</span><br><span class="line">            niceName = <span class="string">"zygote"</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strcmp(arg, <span class="string">"--start-system-server"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            startSystemServer = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strcmp(arg, <span class="string">"--application"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            application = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strncmp(arg, <span class="string">"--nice-name="</span>, <span class="number">12</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">            niceName = arg + <span class="number">12</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            className = arg;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">........</span><br><span class="line"><span class="keyword">if</span> (zygote) &#123;</span><br><span class="line">        runtime.start(<span class="string">"com.android.internal.os.ZygoteInit"</span>,</span><br><span class="line">                startSystemServer ? <span class="string">"start-system-server"</span> : <span class="string">""</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (className) &#123;</span><br><span class="line">        <span class="comment">// Remainder of args get passed to startup class main()</span></span><br><span class="line">        runtime.mClassName = className;</span><br><span class="line">        runtime.mArgC = argc - i;</span><br><span class="line">        runtime.mArgV = argv + i;</span><br><span class="line">        runtime.start(<span class="string">"com.android.internal.os.RuntimeInit"</span>,</span><br><span class="line">                application ? <span class="string">"application"</span> : <span class="string">"tool"</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="built_in">fprintf</span>(stderr, <span class="string">"Error: no class name or --zygote supplied.\n"</span>);</span><br><span class="line">        app_usage();</span><br><span class="line">        LOG_ALWAYS_FATAL(<span class="string">"app_process: no class name or --zygote supplied."</span>);</span><br><span class="line">        return <span class="number">10</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>其中runtime是AppRuntime类型，而AppRuntime继承至AndroidRuntime。我们继续跟踪 runtime.start函数：因在AppRuntime中没有对start的复写，我们到AppRuntime查看start的实现，路劲：android/framework/base/core/init<br>代码如下：注意runtime.start所传的参数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">void</span> AndroidRuntime::start(<span class="keyword">const</span> <span class="keyword">char</span>* className, <span class="keyword">const</span> <span class="keyword">char</span>* options)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">if</span> (<span class="built_in">strcmp</span>(options, <span class="string">"start-system-server"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line"> <span class="comment">/* start the virtual machine */</span></span><br><span class="line"> JNIEnv* env;</span><br><span class="line"> <span class="keyword">if</span> (startVm(&amp;mJavaVM, &amp;env) != <span class="number">0</span>) &#123;</span><br><span class="line">return;</span><br><span class="line"> &#125;</span><br><span class="line"> onVmCreated(env);</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">/*</span><br><span class="line">     * Start VM.  This thread becomes the main thread of the VM, and will</span><br><span class="line">     * not return until the VM exits.</span><br><span class="line">     */</span></span><br><span class="line">    <span class="keyword">char</span>* slashClassName = toSlashClassName(className);</span><br><span class="line">    jclass startClass = env-&gt;FindClass(slashClassName);     <span class="comment">//com.android.internal.os.ZygoteInit</span></span><br><span class="line">    <span class="keyword">if</span> (startClass == <span class="literal">NULL</span>) &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        jmethodID startMeth = env-&gt;GetStaticMethodID(startClass, <span class="string">"main"</span>,</span><br><span class="line">            <span class="string">"([Ljava/lang/String;)V"</span>);</span><br><span class="line">        <span class="keyword">if</span> (startMeth == <span class="literal">NULL</span>) &#123;</span><br><span class="line">            ALOGE(<span class="string">"JavaVM unable to find main() in '%s'\n"</span>, className);</span><br><span class="line">            <span class="comment">/* keep going */</span></span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            env-&gt;CallStaticVoidMethod(startClass, startMeth, strArray);</span><br><span class="line">	    ...</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>即先启动了虚拟机，然后利用JNI调用了zygoteInit。路劲：android/framework/base/core/java/com/android/internal/os在ZygoteInit的main中</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String argv[])</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">if</span> (argv[<span class="number">1</span>].equals(<span class="string">"start-system-server"</span>)) &#123;</span><br><span class="line">                startSystemServer();</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!argv[<span class="number">1</span>].equals(<span class="string">""</span>)) &#123;</span><br><span class="line">                throw new RuntimeException(argv[<span class="number">0</span>] + USAGE_STRING);</span><br><span class="line">            &#125;</span><br><span class="line">            ...</span><br><span class="line">        &#125; <span class="keyword">catch</span> (MethodAndArgsCaller caller) &#123;</span><br><span class="line">            ...</span><br><span class="line">        &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们继续跟踪startSystemServer() ， 在startSystemServer()中 ：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">private static boolean startSystemServer() throws </span><br><span class="line">	MethodAndArgsCaller, RuntimeException &#123;</span><br><span class="line">        String args[] = &#123;</span><br><span class="line">            ...</span><br><span class="line">            "--runtime-init",</span><br><span class="line">            "--nice-name=system_server",</span><br><span class="line">            "com.android.server.SystemServer",</span><br><span class="line">        &#125;;</span><br><span class="line">       </span><br><span class="line">        try &#123;</span><br><span class="line">            parsedArgs = new ZygoteConnection.Arguments(args);</span><br><span class="line">            ...</span><br><span class="line">            pid = Zygote.forkSystemServer(</span><br><span class="line">                    ...</span><br><span class="line">                    parsedArgs.permittedCapabilities,</span><br><span class="line">                    parsedArgs.effectiveCapabilities);</span><br><span class="line">        &#125; catch (IllegalArgumentException ex) &#123;</span><br><span class="line">            throw new RuntimeException(ex);</span><br><span class="line">        &#125;</span><br><span class="line">        ...</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p> Zygote包装了Linux的fork。forkSystemServer()调用forkAndSpecialize()，最终穿过虚拟机调用android\dalvik\vm\native\dalvik_system_Zygote.c中Dalvik_dalvik_system_Zygote_forkAndSpecialize()。由dalvik完成fork新的进程。<br> main()最后会调用runSelectLoopMode()，进入while循环，由peers创建新的进程。</p>
<p>我们跳转至com.android.server.SystemServer中,目录：android/framework/base/services/java/com/android/server </p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    	...</span><br><span class="line">        init1(args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在其main()函数中调用了init1(args)这个native函数，利用JNI机制，跟踪至frameworks/base/services/jni/com_android_server_systemService.cpp，然后到<br>frameworks/base/cmds/system_server/library/system_init.cpp在system_init()函数中有如下代码：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">strcmp</span>(propBuf, <span class="string">"1"</span>) == <span class="number">0</span>) &#123;</span><br><span class="line">    <span class="comment">// Start the SurfaceFlinger</span></span><br><span class="line">    SurfaceFlinger::instantiate();</span><br><span class="line">&#125;</span><br><span class="line">AndroidRuntime* runtime = AndroidRuntime::getRuntime();</span><br><span class="line">...</span><br><span class="line">LOGI(<span class="string">"System server: starting Android services./n"</span>);</span><br><span class="line">runtime-&gt;callStatic(<span class="string">"com/android/server/SystemServer"</span>, <span class="string">"init2"</span>);</span><br></pre></td></tr></table></figure></p>
<p>  即完成了SurfaceFlinger的实例化，然后利用运行时的callStatic()函数调用了SystemServer的init2()函数.代码如下:</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> final <span class="keyword">void</span> <span class="title">init2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       Slog.i(TAG, <span class="string">"Entered the Android system server!"</span>);</span><br><span class="line">       Thread thr = new ServerThread();</span><br><span class="line">       thr.setName(<span class="string">"android.server.ServerThread"</span>);</span><br><span class="line">       thr.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在这个ServerThread线程中，就可以看到我们熟悉的Android服务了：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">@<span class="function">Override</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    EventLog.writeEvent(EventLogTags.BOOT_PROGRESS_SYSTEM_RUN,</span><br><span class="line">        SystemClock.uptimeMillis());</span><br><span class="line"></span><br><span class="line">    Looper.prepareMainLooper();</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    ContentService contentService = null;</span><br><span class="line">    LightsService lights = null;</span><br><span class="line">    PowerManagerService power = null;</span><br><span class="line">    DynamicPManagerService dpm = null;</span><br><span class="line">    DisplayManagerService display = null;</span><br><span class="line">    BatteryService battery = null;</span><br><span class="line">    VibratorService vibrator = null;</span><br><span class="line">    AlarmManagerService alarm = null;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">           </span><br><span class="line">    .....</span><br><span class="line"></span><br><span class="line">   	<span class="keyword">try</span> &#123;</span><br><span class="line">            Slog.i(TAG, <span class="string">"Status Bar"</span>);</span><br><span class="line">            statusBar = new StatusBarManagerService(context, wm);</span><br><span class="line">            ServiceManager.addService(Context.STATUS_BAR_SERVICE, statusBar);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            reportWtf(<span class="string">"starting StatusBarManagerService"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Slog.i(TAG, <span class="string">"Clipboard Service"</span>);</span><br><span class="line">            ServiceManager.addService(Context.CLIPBOARD_SERVICE,</span><br><span class="line">                    new ClipboardService(context));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            reportWtf(<span class="string">"starting Clipboard Service"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Slog.i(TAG, <span class="string">"NetworkManagement Service"</span>);</span><br><span class="line">            networkManagement = NetworkManagementService.create(context);</span><br><span class="line">            ServiceManager.addService(Context.NETWORKMANAGEMENT_SERVICE, networkManagement);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable e) &#123;</span><br><span class="line">            reportWtf(<span class="string">"starting NetworkManagement Service"</span>, e);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">   </span><br><span class="line"></span><br><span class="line">    Looper.loop();</span><br><span class="line">    Slog.d(TAG, <span class="string">"System ServerThread is exiting!"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>最后，调用各服务的systemReady()函数通知系统就绪,至此，系统的启动过程结束.</p>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[XW-Android-02]]></title>
      <url>https://github.com/pkjueying/pkjueying.github.io/2013/12/29/XW-Android-02/</url>
      <content type="html"><![CDATA[<p>在一个新的项目中，在拿到板之前，如果有固件，则获取到相关的配置，并测试相关的外围看是否正常，根据原理图以及相关的资料进行相应的修改，调试相关的驱动等等。。。</p>
<h3 id="wifi模块"><a href="#wifi模块" class="headerlink" title="wifi模块"></a>wifi模块</h3><p>在设置中的wifi模块，首先需要判断硬件是否存在故障；其次在配置文件中注意硬件的高低电平极其引脚；最后注意相关驱动的加载。<br>首先排除硬件，对于相关的配置下面已rtl8188etv为例：</p>
<ol>
<li>在.config中需要配置如下选项，将wifi driver 编译为模块CONFIG_RTL8188EU = m</li>
<li><p>在BoardConfig.mk中</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">#</span></span> 1. Wifi Configuration</span><br><span class="line">BOARD_WIFI_VENDOR := realtek</span><br><span class="line"><span class="tag">\<span class="name">#</span></span>BOARD_WIFI_VENDOR := broadcom</span><br><span class="line"></span><br><span class="line"><span class="tag">\<span class="name">#</span></span> 1.1 realtek wifi support</span><br><span class="line">ifeq (<span class="formula">$(BOARD_WIFI_VENDOR), realtek)</span><br><span class="line">    WPA_SUPPLICANT_VERSION := VER_0_8_X</span><br><span class="line">    BOARD_WPA_SUPPLICANT_DRIVER := NL80211</span><br><span class="line">    BOARD_WPA_SUPPLICANT_PRIVATE_LIB := lib_driver_cmd_rtl</span><br><span class="line">    BOARD_HOSTAPD_DRIVER        := NL80211</span><br><span class="line">    BOARD_HOSTAPD_PRIVATE_LIB   := lib_driver_cmd_rtl</span><br><span class="line"></span><br><span class="line">   # SW_BOARD_USR_WIFI := rtl8192cu</span><br><span class="line">   # BOARD_WLAN_DEVICE := rtl8192cu</span><br><span class="line"></span><br><span class="line">    SW_BOARD_USR_WIFI := rtl8188eu</span><br><span class="line">    BOARD_WLAN_DEVICE := rtl8188eu</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>在init.sun7i.rc中</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">\<span class="name">#</span></span> 1.1 realtek wifi sta service</span><br><span class="line">service wpa_supplicant /system/bin/wpa_supplicant -iwlan0 -Dnl80211 -c/data/misc/wifi/wpa_supplicant.conf -e/data/misc/wifi/entropy.bin</span><br><span class="line">	class main</span><br><span class="line">	socket wpa_wlan0 dgram 660 wifi wifi</span><br><span class="line">	disabled</span><br><span class="line">	oneshot</span><br><span class="line">	</span><br><span class="line"><span class="tag">\<span class="name">#</span></span> 1.2 realtek wifi sta p2p concurrent service</span><br><span class="line">service p2p_supplicant /system/bin/wpa_supplicant <span class="tag">\<span class="name"></span><br><span class="line"></span></span>	-ip2p0 -Dnl80211 -c/data/misc/wifi/p2p_supplicant.conf -e/data/misc/wifi/entropy.bin -N <span class="tag">\<span class="name"></span><br><span class="line"></span></span>	-iwlan0 -Dnl80211 -c/data/misc/wifi/wpa_supplicant.conf</span><br><span class="line">	class main</span><br><span class="line">	socket wpa_wlan0 dgram 660 wifi wifi</span><br><span class="line">	disabled</span><br><span class="line">	oneshot</span><br></pre></td></tr></table></figure>
</li>
<li><p>在sys_config.fex中</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[wifi_para]</span><br><span class="line">wifi_used = 1</span><br><span class="line">wifi_sdc_id = 3</span><br><span class="line">wifi_usbc_id = 2</span><br><span class="line">wifi_usbc_type = 1</span><br><span class="line">wifi_mod_sel = 6</span><br><span class="line">wifi_power = ""</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="耳机"><a href="#耳机" class="headerlink" title="耳机"></a>耳机</h3><p>关于耳机主要是由于时钟频率以及相关的配置，通常在sys_config.fex中进行</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[audio_para]</span><br><span class="line">audio_used = 1</span><br><span class="line">audio_pa_ctrl = port:PH15&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;</span><br><span class="line">audio_earphone_ctrl  = port:PH15&lt;1&gt;&lt;default&gt;&lt;default&gt;&lt;0&gt;</span><br><span class="line">headphone_vol = 0x3f</span><br></pre></td></tr></table></figure>
<p>如果没有声音或者是一些杂音则很可能是由于相关的驱动没有加载成功，要在init.XXXX中进行相关的设置:一般—&gt;insmod /system/vendor/xxx.ko</p>
<h3 id="修改桌面workspace以及AppsCustomize的单元大小"><a href="#修改桌面workspace以及AppsCustomize的单元大小" class="headerlink" title="修改桌面workspace以及AppsCustomize的单元大小"></a>修改桌面workspace以及AppsCustomize的单元大小</h3><p>找到设备对应的桌面布局文件，比如我的1024*600像素的一般在values-sw600dp下<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- AppsCustomize --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"apps_customize_cell_width"</span>&gt;</span>96dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"apps_customize_cell_height"</span>&gt;</span>96dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"apps_customize_pageLayoutPaddingLeft"</span>&gt;</span>12dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"apps_customize_pageLayoutPaddingRight"</span>&gt;</span>12dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"apps_customize_tab_bar_height"</span>&gt;</span>60dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"apps_customize_tab_bar_margin_top"</span>&gt;</span>8dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"apps_customize_widget_cell_width_gap"</span>&gt;</span>20dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"apps_customize_widget_cell_height_gap"</span>&gt;</span>24dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"app_widget_preview_label_margin_top"</span>&gt;</span>8dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"app_widget_preview_label_margin_left"</span>&gt;</span>@dimen/app_widget_preview_padding_left<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"app_widget_preview_label_margin_right"</span>&gt;</span>@dimen/app_widget_preview_padding_right<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Workspace cell size --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"workspace_cell_width_land"</span>&gt;</span>88dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"workspace_cell_width_port"</span>&gt;</span>96dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"workspace_cell_height_land"</span>&gt;</span>88dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"workspace_cell_height_port"</span>&gt;</span>96dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"workspace_width_gap_land"</span>&gt;</span>80dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"workspace_width_gap_port"</span>&gt;</span>2dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"workspace_height_gap_land"</span>&gt;</span>2dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dimen</span> <span class="attr">name</span>=<span class="string">"workspace_height_gap_port"</span>&gt;</span>70dp<span class="tag">&lt;/<span class="name">dimen</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="修改默认输入法"><a href="#修改默认输入法" class="headerlink" title="修改默认输入法"></a>修改默认输入法</h3><p>例如默认为google拼音</p>
<p>1、Z:\exdroid4.2-a20\android4.2\frameworks\base\packages\SettingsProvider\res\values\defaults.xml<br>中添加<br><figure class="highlight xml"><figcaption><span><string name="def_input_method">com.google.android.inputmethod.pinyin/.PinyinIME</string>```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2、Z:\exdroid4.2-a20\android4.2\frameworks\base\packages\SettingsProvider\src\com\android\providers\settings\DatabaseHelper.java</span><br><span class="line"></span><br><span class="line">在</span><br><span class="line">```java private void loadSecureSettings(SQLiteDatabase db) &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>中加上<br><figure class="highlight java"><figcaption><span>loadStringSetting( stmt, Settings.Secure.DEFAULT_INPUT_METHOD,R.string.def_input_method);```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">就可以了</span><br><span class="line"></span><br><span class="line">或者是</span><br><span class="line">在```<span class="function">java <span class="keyword">private</span> <span class="keyword">void</span> <span class="title">loadSecureSettings</span><span class="params">(SQLiteDatabase db)</span>可以改为</span><br><span class="line">            <span class="comment">//def input method</span></span><br><span class="line">            <span class="title">loadSetting</span><span class="params">(stmt, Settings.Secure.DEFAULT_INPUT_METHOD,</span><br><span class="line">                    SystemProperties.get(<span class="string">"def_input_method"</span>,</span><br><span class="line">                            mContext.getResources()</span>.<span class="title">getString</span><span class="params">(R.string.def_input_method)</span>))</span>;</span><br></pre></td></tr></table></figure></p>
<p>可以实现在build.prop中配置输入，比如配置Google拼音，在build.prop中加入<br>def_input_method=com.android.inputmethod.pinyin/.PinyinIME<br>即可,这样处理可以方便使用输入法修改。</p>
<p>ps:在build.prop中加配置可在device配置中的mk文件(比如nuclear_xxx.mk）中处理</p>
<p>3.将该输入法的apk放置/system/app下，如果有lib则将其放入/system/lib/目录下</p>
<p>验证：<br>   mmm ./frameworks/base/packages/SettingsProvider/ -j16<br>   在/data/data/com.android.providers.settings/databases 下，sqlite3 settings.db 用select * from secure ;看见2|default_input_method|com.google.android.inputmethod.pinyin/.PinyinIME 即正确了</p>
<h3 id="邮箱默认签名"><a href="#邮箱默认签名" class="headerlink" title="邮箱默认签名"></a>邮箱默认签名</h3><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">zfl<span class="keyword">@Exdroid</span>:~/android4.2-a20/android/android4.2/packages/apps/Email/src/com/android/email/activity$ git diff MessageCompose.java </span><br><span class="line">diff --git a/src/com/android/email/activity/MessageCompose.java b/src/com/android/email/activity/MessageCompose.java</span><br><span class="line">index <span class="number">0</span>ac7301..d728117 <span class="number">100644</span></span><br><span class="line">--- a/src/com/android/email/activity/MessageCompose.java</span><br><span class="line">+++ b/src/com/android/email/activity/MessageCompose.java</span><br><span class="line">@@ -<span class="number">2330</span>,<span class="number">6</span> +<span class="number">2330</span>,<span class="number">19</span> @@ <span class="keyword">public</span> <span class="keyword">class</span> MessageCompose extends Activity implements OnClickListener, OnFocus</span><br><span class="line">      *     <span class="literal">null</span> or has no signature, &#123;<span class="keyword">@code</span> <span class="literal">null</span>&#125; <span class="keyword">is</span> returned.</span><br><span class="line">      */</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">static</span> String getAccountSignature(Account account) &#123;</span><br><span class="line">-        <span class="keyword">return</span> (account == <span class="literal">null</span>) ? <span class="literal">null</span> : account.mSignature;</span><br><span class="line">+<span class="comment">//        return (account == null) ? null : account.mSignature;</span></span><br><span class="line">+<span class="comment">// change by zfl </span></span><br><span class="line">+       String sinature = <span class="string">"From SANEI N60"</span> ;</span><br><span class="line">+        <span class="keyword">if</span>(account == <span class="literal">null</span>)&#123;</span><br><span class="line">+               <span class="keyword">return</span> sinature;</span><br><span class="line">+        &#125;</span><br><span class="line">+        <span class="keyword">if</span>(account.mSignature == <span class="literal">null</span>)&#123;</span><br><span class="line">+               <span class="keyword">return</span> sinature;</span><br><span class="line">+        &#125;</span><br><span class="line">+        <span class="keyword">if</span>(account.mSignature.isEmpty())&#123;</span><br><span class="line">+               account.mSignature = sinature ;</span><br><span class="line">+        &#125;</span><br><span class="line">+        <span class="keyword">return</span> account.mSignature;</span><br><span class="line">+<span class="comment">//end by zfl </span></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="去掉相机的全景模式"><a href="#去掉相机的全景模式" class="headerlink" title="去掉相机的全景模式"></a>去掉相机的全景模式</h3><p>单<br><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">diff --git a/src/com/android/camera/VideoController.java b/src/com/android/camera/VideoController.java</span><br><span class="line">old mode <span class="number">100644</span></span><br><span class="line"><span class="keyword">new</span> mode <span class="number">100755</span></span><br><span class="line">index d84c1ad..<span class="number">7</span>b4f5e3</span><br><span class="line">--- a/src/com/android/camera/VideoController.java</span><br><span class="line">+++ b/src/com/android/camera/VideoController.java</span><br><span class="line">@@ -<span class="number">75</span>,<span class="number">7</span> +<span class="number">75</span>,<span class="number">10</span> @@ <span class="keyword">public</span> <span class="keyword">class</span> VideoController extends PieController</span><br><span class="line">                 &#125;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line">-        mRenderer.addItem(item);</span><br><span class="line">+        <span class="keyword">int</span> n = CameraHolder.instance().getNumberOfCameras();</span><br><span class="line">+        <span class="keyword">if</span> (n &gt; <span class="number">1</span>) &#123;</span><br><span class="line">+            mRenderer.addItem(item);</span><br><span class="line">+        &#125;</span><br><span class="line">         mOtherKeys = <span class="keyword">new</span> String[] &#123;</span><br><span class="line">                 CameraSettings.KEY_VIDEO_EFFECT,</span><br><span class="line">                 CameraSettings.KEY_VIDEO_TIME_LAPSE_FRAME_INTERVAL,</span><br></pre></td></tr></table></figure></p>
<p>双：<br><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">zfl<span class="keyword">@Exdroid</span>:~/android4.2-a20/android/android4.2/packages/apps/Camera/src/com/android/camera$ git diff CameraActivity.java</span><br><span class="line">diff --git a/src/com/android/camera/CameraActivity.java b/src/com/android/camera/CameraActivity.java</span><br><span class="line">index ec2c2d2..c91dd54 <span class="number">100755</span></span><br><span class="line">--- a/src/com/android/camera/CameraActivity.java</span><br><span class="line">+++ b/src/com/android/camera/CameraActivity.java</span><br><span class="line">@@ -<span class="number">85</span>,<span class="number">7</span> +<span class="number">85</span>,<span class="number">9</span> @@ <span class="keyword">public</span> <span class="keyword">class</span> CameraActivity extends ActivityBase</span><br><span class="line">                 &amp;&amp; CameraHolder.instance().getFrontCameraId() == <span class="number">0</span>) &#123;</span><br><span class="line">             DRAW_IDS = DRAW_IDS_WITHOUT_PAN;</span><br><span class="line">         &#125; <span class="keyword">else</span>  &#123;</span><br><span class="line">-            DRAW_IDS = DRAW_IDS_WITH_PAN;</span><br><span class="line">+<span class="comment">//            DRAW_IDS = DRAW_IDS_WITH_PAN;</span></span><br><span class="line">+<span class="comment">//zfl </span></span><br><span class="line">+             DRAW_IDS = DRAW_IDS_WITHOUT_PAN;</span><br><span class="line">         &#125;</span><br><span class="line">         mDrawables = <span class="keyword">new</span> Drawable[DRAW_IDS.length];</span><br><span class="line">         <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DRAW_IDS.length; i++) &#123;</span><br></pre></td></tr></table></figure></p>
<h3 id="相机字体关闭打开显示不全"><a href="#相机字体关闭打开显示不全" class="headerlink" title="相机字体关闭打开显示不全"></a>相机字体关闭打开显示不全</h3><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">zfl<span class="keyword">@Exdroid</span>:~/android4.2-a20/android/android4.2/packages/apps/Camera$ git diff ./res/values/dimens.xml</span><br><span class="line">diff --git a/res/values/dimens.xml b/res/values/dimens.xml</span><br><span class="line">index cb38007..ce45209 <span class="number">100644</span></span><br><span class="line">--- a/res/values/dimens.xml</span><br><span class="line">+++ b/res/values/dimens.xml</span><br><span class="line">@@ -<span class="number">23</span>,<span class="number">7</span> +<span class="number">23</span>,<span class="number">8</span> @@</span><br><span class="line">     &lt;dimen name=<span class="string">"setting_item_text_size"</span>&gt;<span class="number">18</span>sp&lt;/dimen&gt;</span><br><span class="line">     &lt;dimen name=<span class="string">"setting_knob_width"</span>&gt;<span class="number">20</span>dp&lt;/dimen&gt;</span><br><span class="line">     &lt;dimen name=<span class="string">"setting_knob_text_size"</span>&gt;<span class="number">20</span>dp&lt;/dimen&gt;</span><br><span class="line">-    &lt;dimen name=<span class="string">"setting_item_text_width"</span>&gt;<span class="number">95</span>dp&lt;/dimen&gt;</span><br><span class="line">+&lt;!--  zfl  &lt;dimen name=<span class="string">"setting_item_text_width"</span>&gt;<span class="number">95</span>dp&lt;/dimen&gt; --&gt;</span><br><span class="line">+    &lt;dimen name=<span class="string">"setting_item_text_width"</span>&gt;<span class="number">115</span>dp&lt;/dimen&gt;</span><br><span class="line">     &lt;dimen name=<span class="string">"setting_popup_window_width"</span>&gt;<span class="number">240</span>dp&lt;/dimen&gt;</span><br><span class="line">     &lt;dimen name=<span class="string">"setting_item_list_margin"</span>&gt;<span class="number">14</span>dp&lt;/dimen&gt;</span><br><span class="line">     &lt;dimen name=<span class="string">"indicator_bar_width"</span>&gt;<span class="number">48</span>dp&lt;/dimen&gt;</span><br></pre></td></tr></table></figure>
<h3 id="修改桌面布局"><a href="#修改桌面布局" class="headerlink" title="修改桌面布局"></a>修改桌面布局</h3><p>实现办法</p>
<ol>
<li>下载 GetLayout.apk</li>
<li>adb push它们到平板电脑的/system/app中，然后后启平板电脑。</li>
<li>在应用列表中点击GetLayout应用图标以开启该应用：</li>
</ol>
<p>程序会自动运行，显示一个Toast提示成功生成“/data/data/com.xw.getlayout/files/home_layout.xml”的消息，然后程序自动退出。<br>将GetLayout.apk生成的home_layout.xml从平板电脑中抽取到本地：</p>
<figure class="highlight bash"><figcaption><span>adb pull</span><a href="/data/data/com.xw.getlayout/files/home_layout.xml">~/ ```</a></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">4. 用上面克隆出来的home_layout.xml来编译Laucher2：</span><br><span class="line">用home_layout.xml覆盖Launcher应用中所有的“default_workspace.xml”：</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line">cp -rf ~/home_layout.xml packages/apps/Launcher2/res/xml/default_workspace.xml</span><br><span class="line">cp -rf ~/home_layout.xml packages/apps/Launcher2/res/xml-sw480dp/default_workspace.xml</span><br><span class="line">cp -rf ~/home_layout.xml packages/apps/Launcher2/res/xml-sw600dp/default_workspace.xml</span><br><span class="line">cp -rf ~/home_layout.xml packages/apps/Launcher2/res/xml-sw720dp/default_workspace.xml</span><br><span class="line"></span><br><span class="line">chmod 777 packages/apps/Launcher2/res/xml/default_workspace.xml</span><br><span class="line">chmod 777 packages/apps/Launcher2/res/xml-sw480dp/default_workspace.xml</span><br><span class="line">chmod 777 packages/apps/Launcher2/res/xml-sw600dp/default_workspace.xml</span><br><span class="line">chmod 777 packages/apps/Launcher2/res/xml-sw720dp/default_workspace.xml</span><br></pre></td></tr></table></figure>
<p>//重新编译Laucher2:<br><figure class="highlight bash"><figcaption><span>mmm -B packages/apps/Launcher2 -j16  ```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">//将新生成的Launcher2.apk安装到平板上：</span><br><span class="line">```bash</span><br><span class="line">adb push out/target/product/wing-k70/system/app/Launcher2.apk /system/app</span><br></pre></td></tr></table></figure></p>
<h3 id="修改系统内存"><a href="#修改系统内存" class="headerlink" title="修改系统内存"></a>修改系统内存</h3><p>已1G为例：</p>
<ol>
<li>在BoardConfig.mk文件中 设置BOARD_USERDATAIMAGE_PARTITION_SIZE := 1073741824</li>
<li>在sys_partion.fex中设置 <figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">;------------------------------&gt;mmcblk0p8/nande</span><br><span class="line">[partition]</span><br><span class="line">name         = data</span><br><span class="line">    size         = 2097152</span><br><span class="line">    user_type    = 0x2</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="视频缩放模式默认全屏"><a href="#视频缩放模式默认全屏" class="headerlink" title="视频缩放模式默认全屏"></a>视频缩放模式默认全屏</h3><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">zfl<span class="keyword">@Exdroid</span>:~/android4.2-a20/android/android4.2/packages/apps/Gallery2$ git diff src/com/android/gallery3d/app/MovieViewControl.java</span><br><span class="line">diff --git a/src/com/android/gallery3d/app/MovieViewControl.java b/src/com/android/gallery3d/app/MovieViewControl.java</span><br><span class="line">index ea7087d..a01b9a0 <span class="number">100755</span></span><br><span class="line">--- a/src/com/android/gallery3d/app/MovieViewControl.java</span><br><span class="line">+++ b/src/com/android/gallery3d/app/MovieViewControl.java</span><br><span class="line">@@ -<span class="number">1024</span>,<span class="number">7</span> +<span class="number">1024</span>,<span class="number">8</span> @@ VideoView.OnSubFocusItems&#123;</span><br><span class="line">mControlFocus = EDITOR_ZOOM;</span><br><span class="line"></span><br><span class="line">mDialogTitle.setText(R.<span class="built_in">string</span>.zoom_title);</span><br><span class="line">- <span class="keyword">int</span> currentMode = sp.getInt(EDITOR_ZOOM, <span class="number">0</span>);</span><br><span class="line">+<span class="comment">// int currentMode = sp.getInt(EDITOR_ZOOM, 0);</span></span><br><span class="line">+ <span class="keyword">int</span> currentMode = sp.getInt(EDITOR_ZOOM, <span class="number">1</span>); <span class="comment">// zfl</span></span><br><span class="line"><span class="keyword">int</span>[] list = mRes.getIntArray(R.array.screen_zoom_values);</span><br><span class="line"><span class="keyword">for</span>(mListFocus = <span class="number">0</span>; mListFocus &lt; list.length; mListFocus++) &#123;</span><br><span class="line"><span class="keyword">if</span>(currentMode == list[mListFocus]) &#123;</span><br><span class="line">@@ -<span class="number">1144</span>,<span class="number">7</span> +<span class="number">1145</span>,<span class="number">8</span> @@ VideoView.OnSubFocusItems&#123;</span><br><span class="line">mVideoView.setSubPosition(offset);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* zoom mode */</span></span><br><span class="line">- <span class="keyword">int</span> zoom = sp.getInt(EDITOR_ZOOM, <span class="number">0</span>);</span><br><span class="line">+<span class="comment">// int zoom = sp.getInt(EDITOR_ZOOM, 0);</span></span><br><span class="line">+ <span class="keyword">int</span> zoom = sp.getInt(EDITOR_ZOOM, <span class="number">1</span>); <span class="comment">//zfl</span></span><br><span class="line">mVideoView.setZoomMode(zoom);</span><br></pre></td></tr></table></figure>
<h3 id="锁屏界面将向下的解锁换成向右的"><a href="#锁屏界面将向下的解锁换成向右的" class="headerlink" title="锁屏界面将向下的解锁换成向右的"></a>锁屏界面将向下的解锁换成向右的</h3><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">zfl<span class="keyword">@Exdroid</span>:~/android4.2-a20/android/android4.2/frameworks/base/core/res/res$ git diff values-sw600dp-land/arrays.xml</span><br><span class="line">diff --git a/core/res/res/values-sw600dp-land/arrays.xml b/core/res/res/values-sw600dp-land/arrays.xml</span><br><span class="line">index <span class="number">5550216.</span>.<span class="number">2</span>eabf66 <span class="number">100644</span></span><br><span class="line">--- a/core/res/res/values-sw600dp-land/arrays.xml</span><br><span class="line">+++ b/core/res/res/values-sw600dp-land/arrays.xml</span><br><span class="line">@@ -<span class="number">22</span>,<span class="number">35</span> +<span class="number">22</span>,<span class="number">35</span> @@</span><br><span class="line">     &lt;!-- Resources <span class="keyword">for</span> GlowPadView <span class="keyword">in</span> LockScreen --&gt;</span><br><span class="line">     &lt;array name=<span class="string">"lockscreen_targets_when_silent"</span>&gt;</span><br><span class="line">         &lt;item&gt;<span class="keyword">@drawable</span>/ic_lockscreen_unlock&lt;/item&gt;</span><br><span class="line">-        &lt;item&gt;<span class="keyword">@null</span>&lt;/item&gt;</span><br><span class="line">+        &lt;item&gt;<span class="keyword">@drawable</span>/ic_action_assist_generic&lt;/item&gt;</span><br><span class="line">         &lt;item&gt;<span class="keyword">@drawable</span>/ic_lockscreen_soundon&lt;/item&gt;</span><br><span class="line">         &lt;item&gt;<span class="keyword">@null</span>&lt;/item&gt;</span><br><span class="line">     &lt;/array&gt;</span><br><span class="line"> </span><br><span class="line">     &lt;array name=<span class="string">"lockscreen_target_descriptions_when_silent"</span>&gt;</span><br><span class="line">         &lt;item&gt;<span class="keyword">@string</span>/description_target_unlock&lt;/item&gt;</span><br><span class="line">-        &lt;item&gt;<span class="keyword">@null</span>&lt;/item&gt;</span><br><span class="line">+        &lt;item&gt;<span class="keyword">@string</span>/description_target_search&lt;/item&gt;</span><br><span class="line">         &lt;item&gt;<span class="keyword">@string</span>/description_target_soundon&lt;/item&gt;</span><br><span class="line">         &lt;item&gt;<span class="keyword">@null</span>&lt;/item&gt;</span><br><span class="line">     &lt;/array&gt;</span><br><span class="line"> </span><br><span class="line">     &lt;array name=<span class="string">"lockscreen_direction_descriptions"</span>&gt;</span><br><span class="line">         &lt;item&gt;<span class="keyword">@string</span>/description_direction_right&lt;/item&gt;</span><br><span class="line">-        &lt;item&gt;<span class="keyword">@null</span>&lt;/item&gt;</span><br><span class="line">+        &lt;item&gt;<span class="keyword">@string</span>/description_direction_up&lt;/item&gt;</span><br><span class="line">         &lt;item&gt;<span class="keyword">@string</span>/description_direction_left&lt;/item&gt;</span><br><span class="line">         &lt;item&gt;<span class="keyword">@null</span>&lt;/item&gt;</span><br><span class="line">     &lt;/array&gt;</span><br><span class="line"> </span><br><span class="line">     &lt;array name=<span class="string">"lockscreen_targets_when_soundon"</span>&gt;</span><br><span class="line">         &lt;item&gt;<span class="keyword">@drawable</span>/ic_lockscreen_unlock&lt;/item&gt;</span><br><span class="line">-        &lt;item&gt;<span class="keyword">@null</span>&lt;/item&gt;</span><br><span class="line">+        &lt;item&gt;<span class="keyword">@drawable</span>/ic_action_assist_generic&lt;/item&gt;</span><br><span class="line">         &lt;item&gt;<span class="keyword">@drawable</span>/ic_lockscreen_silent&lt;/item&gt;</span><br><span class="line">         &lt;item&gt;<span class="keyword">@null</span>&lt;/item&gt;</span><br><span class="line">     &lt;/array&gt;</span><br><span class="line"> </span><br><span class="line">     &lt;array name=<span class="string">"lockscreen_target_descriptions_when_soundon"</span>&gt;</span><br><span class="line">         &lt;item&gt;<span class="keyword">@string</span>/description_target_unlock&lt;/item&gt;</span><br><span class="line">-        &lt;item&gt;<span class="keyword">@null</span>&lt;/item&gt;</span><br><span class="line">+        &lt;item&gt;<span class="keyword">@string</span>/description_target_search&lt;/item&gt;</span><br><span class="line">         &lt;item&gt;<span class="keyword">@string</span>/description_target_silent&lt;/item&gt;</span><br><span class="line">         &lt;item&gt;<span class="keyword">@null</span>&lt;/item&gt;</span><br><span class="line">     &lt;/array&gt;</span><br></pre></td></tr></table></figure>
<h3 id="默认动态壁纸"><a href="#默认动态壁纸" class="headerlink" title="默认动态壁纸"></a>默认动态壁纸</h3><p>以蘑菇云为例，如下<br><img src="/img/xw/20130909135608859.png" alt=""></p>
<h3 id="分区相关的东东"><a href="#分区相关的东东" class="headerlink" title="分区相关的东东"></a>分区相关的东东</h3><p>主要涉及到两个文件：sys_partition以及BoardConfig   相关修改见下图：<br><img src="/img/xw/20130910111249375.png" alt=""></p>
<p><img src="/img/xw/20130910111305531.png" alt=""></p>
<p>结果如下图：<br><img src="/img/xw/20130910111350093.png" alt=""></p>
<h3 id="在build-prop中用属性值来默认动态壁纸"><a href="#在build-prop中用属性值来默认动态壁纸" class="headerlink" title="在build.prop中用属性值来默认动态壁纸"></a>在build.prop中用属性值来默认动态壁纸</h3><p>首先我们在build.prop文件中添加已属性值：修改pack_before.sh脚本添加两行,如下图：<br><img src="/img/xw/20130911150346765.png" alt=""></p>
<p>其中红色的箭头就是动态壁纸相关的包名以及服务名<br>然后我们在/frameworks/base/services/java/com/android/server下的WallpaperManagerService.java 文件中作如下修改即可：<br><img src="/img/xw/20130911150810187.png" alt=""></p>
<p>最后烧写固件<br>打印的Log日志如下：<br><img src="/img/xw/20130911151027828.png" alt=""></p>
<h3 id="相机拍照存储中的“打开-关闭”显示不全"><a href="#相机拍照存储中的“打开-关闭”显示不全" class="headerlink" title="相机拍照存储中的“打开-关闭”显示不全"></a>相机拍照存储中的“打开-关闭”显示不全</h3><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">zfl<span class="keyword">@Exdroid</span>:~/common_a20/android/packages/apps/Camera$ git diff res/values/dimens.xml</span><br><span class="line">diff --git a/res/values/dimens.xml b/res/values/dimens.xml</span><br><span class="line">old mode <span class="number">100644</span></span><br><span class="line"><span class="keyword">new</span> mode <span class="number">100755</span></span><br><span class="line">index cb38007..ec1bacc</span><br><span class="line">--- a/res/values/dimens.xml</span><br><span class="line">+++ b/res/values/dimens.xml</span><br><span class="line">@@ -<span class="number">23</span>,<span class="number">7</span> +<span class="number">23</span>,<span class="number">8</span> @@</span><br><span class="line">     &lt;dimen name=<span class="string">"setting_item_text_size"</span>&gt;<span class="number">18</span>sp&lt;/dimen&gt;</span><br><span class="line">     &lt;dimen name=<span class="string">"setting_knob_width"</span>&gt;<span class="number">20</span>dp&lt;/dimen&gt;</span><br><span class="line">     &lt;dimen name=<span class="string">"setting_knob_text_size"</span>&gt;<span class="number">20</span>dp&lt;/dimen&gt;</span><br><span class="line">-    &lt;dimen name=<span class="string">"setting_item_text_width"</span>&gt;<span class="number">95</span>dp&lt;/dimen&gt;</span><br><span class="line">+&lt;!--  zfl  &lt;dimen name=<span class="string">"setting_item_text_width"</span>&gt;<span class="number">95</span>dp&lt;/dimen&gt; --&gt;</span><br><span class="line">+    &lt;dimen name=<span class="string">"setting_item_text_width"</span>&gt;<span class="number">120</span>dp&lt;/dimen&gt;</span><br><span class="line">     &lt;dimen name=<span class="string">"setting_popup_window_width"</span>&gt;<span class="number">240</span>dp&lt;/dimen&gt;</span><br><span class="line">     &lt;dimen name=<span class="string">"setting_item_list_margin"</span>&gt;<span class="number">14</span>dp&lt;/dimen&gt;</span><br></pre></td></tr></table></figure>
<h3 id="后置摄像头拍照画面拉伸"><a href="#后置摄像头拍照画面拉伸" class="headerlink" title="后置摄像头拍照画面拉伸"></a>后置摄像头拍照画面拉伸</h3><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">zfl<span class="keyword">@Exdroid</span>:/media/home2/zfl/common_a20/android/packages/apps/Camera$ git diff res/values/arrays.xml</span><br><span class="line">diff --git a/res/values/arrays.xml b/res/values/arrays.xml</span><br><span class="line">index c6a823b..<span class="number">7</span>c30b77 <span class="number">100644</span></span><br><span class="line">--- a/res/values/arrays.xml</span><br><span class="line">+++ b/res/values/arrays.xml</span><br><span class="line">@@ -<span class="number">29</span>,<span class="number">9</span> +<span class="number">29</span>,<span class="number">9</span> @@</span><br><span class="line"></span><br><span class="line"><span class="number">6</span></span><br><span class="line"></span><br><span class="line">- <span class="keyword">@string</span>/pref_video_quality_default</span><br><span class="line">+ <span class="number">5</span></span><br><span class="line"></span><br><span class="line">- <span class="number">4</span></span><br><span class="line">+ <span class="keyword">@string</span>/pref_video_quality_default</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">zfl<span class="keyword">@Exdroid</span>:/media/home2/zfl/common_a20/android/packages/apps/Camera$ git diff res/values/strings.xml</span><br><span class="line">diff --git a/res/values/strings.xml b/res/values/strings.xml</span><br><span class="line">index <span class="number">23</span>ba8f8..<span class="number">9861</span>be7 <span class="number">100644</span></span><br><span class="line">--- a/res/values/strings.xml</span><br><span class="line">+++ b/res/values/strings.xml</span><br><span class="line">@@ -<span class="number">86</span>,<span class="number">7</span> +<span class="number">86</span>,<span class="number">7</span> @@</span><br><span class="line"></span><br><span class="line">Video quality</span><br><span class="line"></span><br><span class="line">- <span class="number">5</span></span><br><span class="line">+ <span class="number">4</span></span><br><span class="line"></span><br><span class="line">HD <span class="number">1080</span>p</span><br></pre></td></tr></table></figure>
<h3 id="在init-sunxx-rc中新建目录以及复制相关的文件到该目录（比如竞技摩托的lib库）"><a href="#在init-sunxx-rc中新建目录以及复制相关的文件到该目录（比如竞技摩托的lib库）" class="headerlink" title="在init.sunxx.rc中新建目录以及复制相关的文件到该目录（比如竞技摩托的lib库）"></a>在init.sunxx.rc中新建目录以及复制相关的文件到该目录（比如竞技摩托的lib库）</h3><p>下面就已竞技摩托为例：场景是在固件中将竞技摩托放在system 的 app下，不能卸载，由于该app的lib库是在特定的目录下寻找，找不到直接报错，而不会再到system/lib下继续寻找，所以我们只能将其相关的Lib库放置在其目录下：<br><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">zfl<span class="keyword">@Exdroid</span>:~/common_a20/android/device/softwinner/wingchiphd-other$ git diff init.sun7i.rc</span><br><span class="line">diff --git a/init.sun7i.rc b/init.sun7i.rc</span><br><span class="line">index <span class="number">786309</span>d..<span class="number">14</span>f3e4e <span class="number">100755</span></span><br><span class="line">--- a/init.sun7i.rc</span><br><span class="line">+++ b/init.sun7i.rc</span><br><span class="line">@@ -<span class="number">42</span>,<span class="number">7</span> +<span class="number">42</span>,<span class="number">7</span> @@ on fs</span><br><span class="line">     exec /system/bin/logwrapper /system/bin/e2fsck -y /dev/block/cache</span><br><span class="line">     exec /system/bin/busybox mount -t ext4 -o noatime,nosuid,nodev,barrier=<span class="number">0</span>,journal_checksum,noauto_da_alloc /dev/block/cache /cac</span><br><span class="line"> </span><br><span class="line">-    format_userdata /dev/block/UDISK CT720</span><br><span class="line">+    format_userdata /dev/block/UDISK CT720K</span><br><span class="line"> # zfl</span><br><span class="line">     format_userdata /dev/block/<span class="keyword">private</span> PRIVATE</span><br><span class="line">     mkdir /mnt/<span class="keyword">private</span> <span class="number">0</span>770 system system</span><br><span class="line">@@ -<span class="number">61</span>,<span class="number">6</span> +<span class="number">61</span>,<span class="number">22</span> @@ on boot</span><br><span class="line">        insmod /system/vendor/modules/sw_device.ko</span><br><span class="line">        chmod <span class="number">777</span> /data/misc</span><br><span class="line"> </span><br><span class="line">+mkdir /data/app-lib/RiptideGP</span><br><span class="line">+chown root root /data/app-lib/RiptideGP</span><br><span class="line">+chmod <span class="number">0</span>755 /data/app-lib/RiptideGP</span><br><span class="line">+</span><br><span class="line">+copy /system/lib/libBlue.so  /data/app-lib/RiptideGP/libBlue.so</span><br><span class="line">+chown root root /data/app-lib/RiptideGP/libBlue.so</span><br><span class="line">+chmod <span class="number">0</span>755 /data/app-lib/RiptideGP/libBlue.so</span><br><span class="line">+</span><br><span class="line">+copy /system/lib/libfmodex.so  /data/app-lib/RiptideGP/libfmodex.so</span><br><span class="line">+chown root root /data/app-lib/RiptideGP/libfmodex.so</span><br><span class="line">+chmod <span class="number">0</span>755 /data/app-lib/RiptideGP/libfmodex.so</span><br><span class="line">+</span><br><span class="line">+copy /system/lib/libfmodevent.so /data/app-lib/RiptideGP/libfmodevent.so</span><br><span class="line">+chown root root /data/app-lib/RiptideGP/libfmodevent.so</span><br><span class="line">+chmod <span class="number">0</span>755 /data/app-lib/RiptideGP/libfmodevent.so</span><br></pre></td></tr></table></figure></p>
<h3 id="按键音"><a href="#按键音" class="headerlink" title="按键音"></a>按键音</h3><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">zfl<span class="keyword">@Exdroid</span>:~/common_a20/android/frameworks/base$ git diff policy/src/com/android/internal/policy/impl/PhoneWindowManager.java</span><br><span class="line">diff --git a/policy/src/com/android/internal/policy/impl/PhoneWindowManager.java b/policy/src/com/android/internal/policy/impl/Phone</span><br><span class="line">index fc9bd0f..<span class="number">8635010</span> <span class="number">100755</span></span><br><span class="line">--- a/policy/src/com/android/internal/policy/impl/PhoneWindowManager.java</span><br><span class="line">+++ b/policy/src/com/android/internal/policy/impl/PhoneWindowManager.java</span><br><span class="line">@@ -<span class="number">3565</span>,<span class="number">6</span> +<span class="number">3565</span>,<span class="number">12</span> @@ <span class="keyword">public</span> <span class="keyword">class</span> PhoneWindowManager implements WindowManagerPolicy &#123;</span><br><span class="line">             <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">final</span> boolean down = event.getAction() == KeyEvent.ACTION_DOWN;</span><br><span class="line">+<span class="comment">// zfl</span></span><br><span class="line">+       <span class="keyword">if</span>(!down) &#123;</span><br><span class="line">+               AudioManager am = (AudioManager)mContext.getSystemService(Context.AUDIO_SERVICE);</span><br><span class="line">+               am.playSoundEffect(android.view.SoundEffectConstants.CLICK);</span><br><span class="line">+       &#125;</span><br><span class="line">+</span><br><span class="line">         <span class="keyword">final</span> boolean canceled = event.isCanceled();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">桌面Workspace文本大小设置</span><br><span class="line"></span><br><span class="line">zfl<span class="keyword">@Exdroid</span>:~/common_a20/android/packages/apps/Launcher2$ git diff src/com/android/launcher2/BubbleTextView.java</span><br><span class="line">diff --git a/src/com/android/launcher2/BubbleTextView.java b/src/com/android/launcher2/BubbleTextView.java</span><br><span class="line">index <span class="number">610</span>aedc..c86b49e <span class="number">100755</span></span><br><span class="line">--- a/src/com/android/launcher2/BubbleTextView.java</span><br><span class="line">+++ b/src/com/android/launcher2/BubbleTextView.java</span><br><span class="line">@@ -<span class="number">55</span>,<span class="number">6</span> +<span class="number">55</span>,<span class="number">8</span> @@ <span class="keyword">public</span> <span class="keyword">class</span> BubbleTextView extends TextView &#123;</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">int</span> mPressedOutlineColor;</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">int</span> mPressedGlowColor;</span><br><span class="line"> </span><br><span class="line">+       <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> bubbleTextInt = <span class="number">14</span> ; </span><br><span class="line">+</span><br><span class="line">     <span class="keyword">private</span> boolean mBackgroundSizeChanged;</span><br><span class="line">     <span class="keyword">private</span> Drawable mBackground;</span><br><span class="line"> </span><br><span class="line">@@ -<span class="number">79</span>,<span class="number">6</span> +<span class="number">81</span>,<span class="number">9</span> @@ <span class="keyword">public</span> <span class="keyword">class</span> BubbleTextView extends TextView &#123;</span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">void</span> init() &#123;</span><br><span class="line">         mLongPressHelper = <span class="keyword">new</span> CheckLongPressHelper(<span class="keyword">this</span>);</span><br><span class="line">         mBackground = getBackground();</span><br><span class="line">+       <span class="comment">//zfl</span></span><br><span class="line">+       <span class="keyword">super</span>.setTextSize(bubbleTextInt) ;</span><br><span class="line">+</span><br></pre></td></tr></table></figure>
<h3 id="在配置中修改浏览器模式"><a href="#在配置中修改浏览器模式" class="headerlink" title="在配置中修改浏览器模式"></a>在配置中修改浏览器模式</h3><p>首先在build.prop中设置属性：ro.browser.user_agent<br>然后在java中修改相关代码即可：</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">zfl<span class="keyword">@Exdroid</span>:~/common_a20/android/packages/apps/Browser$ git diff ./src/com/android/browser/preferences/BrowserModeFragment.java    </span><br><span class="line">diff --git a/src/com/android/browser/preferences/BrowserModeFragment.java b/src/com/android/browser/preferences/BrowserModeFragment.</span><br><span class="line">index ab7a411..<span class="number">9e4</span>bc40 <span class="number">100755</span></span><br><span class="line">--- a/src/com/android/browser/preferences/BrowserModeFragment.java</span><br><span class="line">+++ b/src/com/android/browser/preferences/BrowserModeFragment.java</span><br><span class="line">@@ -<span class="number">45</span>,<span class="number">8</span> +<span class="number">45</span>,<span class="number">12</span> @@ <span class="keyword">public</span> <span class="keyword">class</span> BrowserModeFragment extends Fragment implements</span><br><span class="line">                LayoutParams lp = <span class="keyword">new</span> LayoutParams(LayoutParams.MATCH_PARENT,</span><br><span class="line">                                LayoutParams.WRAP_CONTENT);</span><br><span class="line">                radioGroup.setLayoutParams(lp);</span><br><span class="line">-               String def = mPref.getString(PreferenceKeys.PREF_USER_AGENT,</span><br><span class="line">-                               <span class="string">"3"</span>);</span><br><span class="line">+</span><br><span class="line">+               <span class="comment">//add by zfl </span></span><br><span class="line">+               String user_agent = android.os.SystemProperties.get(<span class="string">"ro.browser.user_agent"</span> , <span class="string">"3"</span>) ;</span><br><span class="line">+</span><br><span class="line">+               String def = mPref.getString(PreferenceKeys.PREF_USER_AGENT, user_agent);</span><br><span class="line">+</span><br><span class="line">                <span class="keyword">if</span> (mEntries != <span class="literal">null</span> &amp;&amp; mEntryValues != <span class="literal">null</span>) &#123;</span><br></pre></td></tr></table></figure>
<h3 id="去掉相机拍照时手势的缩放功能"><a href="#去掉相机拍照时手势的缩放功能" class="headerlink" title="去掉相机拍照时手势的缩放功能"></a>去掉相机拍照时手势的缩放功能</h3><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">zfl<span class="keyword">@Exdroid</span>:~/common_a20/android/packages/apps/Camera$ git diff src/com/android/camera/ui/ZoomRenderer.java</span><br><span class="line">diff --git a/src/com/android/camera/ui/ZoomRenderer.java b/src/com/android/camera/ui/ZoomRenderer.java</span><br><span class="line">index <span class="number">10</span>c5e80..<span class="number">6643634</span> <span class="number">100644</span></span><br><span class="line">--- a/src/com/android/camera/ui/ZoomRenderer.java</span><br><span class="line">+++ b/src/com/android/camera/ui/ZoomRenderer.java</span><br><span class="line">@@ -<span class="number">50</span>,<span class="number">8</span> +<span class="number">50</span>,<span class="number">8</span> @@ <span class="keyword">public</span> <span class="keyword">class</span> ZoomRenderer extends OverlayRenderer</span><br><span class="line">     <span class="keyword">private</span> Rect mTextBounds;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">interface</span> OnZoomChangedListener &#123;</span><br><span class="line">-        <span class="keyword">void</span> onZoomStart();</span><br><span class="line">-        <span class="keyword">void</span> onZoomEnd();</span><br><span class="line">+       <span class="keyword">void</span> onZoomStart();</span><br><span class="line">+       <span class="keyword">void</span> onZoomEnd();</span><br><span class="line">         <span class="keyword">void</span> onZoomValueChanged(<span class="keyword">int</span> index);  <span class="comment">// only for immediate zoom</span></span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">@@ -<span class="number">125</span>,<span class="number">7</span> +<span class="number">125</span>,<span class="number">7</span> @@ <span class="keyword">public</span> <span class="keyword">class</span> ZoomRenderer extends OverlayRenderer</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">@Override</span></span><br><span class="line">     <span class="keyword">public</span> boolean onScale(ScaleGestureDetector detector) &#123;</span><br><span class="line">-        <span class="keyword">final</span> <span class="built_in">float</span> sf = detector.getScaleFactor();</span><br><span class="line">+      <span class="comment">/*  final float sf = detector.getScaleFactor();</span><br><span class="line">         float circle = (int) (mCircleSize * sf * sf);</span><br><span class="line">         circle = Math.max(mMinCircle, circle);</span><br><span class="line">         circle = Math.min(mMaxCircle, circle);</span><br><span class="line">@@ -134,25 +134,28 @@ public class ZoomRenderer extends OverlayRenderer</span><br><span class="line">             int zoom = mMinZoom + (int) ((mCircleSize - mMinCircle) * (mMaxZoom - mMinZoom) / (mMaxCircle - mMinCircle));</span><br><span class="line">             mListener.onZoomValueChanged(zoom);</span><br><span class="line">         &#125;</span><br><span class="line">+       */</span></span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">@Override</span></span><br><span class="line">     <span class="keyword">public</span> boolean onScaleBegin(ScaleGestureDetector detector) &#123;</span><br><span class="line">-        setVisible(<span class="literal">true</span>);</span><br><span class="line">+  <span class="comment">/*      setVisible(true);</span><br><span class="line">         if (mListener != null) &#123;</span><br><span class="line">             mListener.onZoomStart();</span><br><span class="line">         &#125;</span><br><span class="line">         update();</span><br><span class="line">+       */</span></span><br><span class="line">         <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">     &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">@Override</span></span><br><span class="line">     <span class="keyword">public</span> <span class="keyword">void</span> onScaleEnd(ScaleGestureDetector detector) &#123;</span><br><span class="line">-        setVisible(<span class="literal">false</span>);</span><br><span class="line">+ <span class="comment">/*       setVisible(false);</span><br><span class="line">         if (mListener != null) &#123;</span><br><span class="line">             mListener.onZoomEnd();</span><br><span class="line">         &#125;</span><br><span class="line">+*/</span></span><br><span class="line">     &#125;</span><br></pre></td></tr></table></figure>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[XW-Android]]></title>
      <url>https://github.com/pkjueying/pkjueying.github.io/2013/12/18/XW-Android-01/</url>
      <content type="html"><![CDATA[<h3 id="关机充电图标不显示："><a href="#关机充电图标不显示：" class="headerlink" title="关机充电图标不显示："></a>关机充电图标不显示：</h3><p>现象：<br>开机后，插入充电器，再按正常流程关机。 关机后，短按power键，屏幕无充电图标显示(此时充电器还是插入的)。</p>
<p>解决方法：<br>配置 [pmu_para] power_start = 0 即可</p>
<h3 id="data分区扩到4G-恢复出厂设置就没作用了"><a href="#data分区扩到4G-恢复出厂设置就没作用了" class="headerlink" title="data分区扩到4G 恢复出厂设置就没作用了"></a>data分区扩到4G 恢复出厂设置就没作用了</h3><p>解决方法：</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">diff --git a/drivers/mtd/nand/sunxi_nand.c b/drivers/mtd/nand/sunxi_nand.c</span><br><span class="line">old mode <span class="number">100644</span></span><br><span class="line"><span class="keyword">new</span> mode <span class="number">100755</span></span><br><span class="line">index <span class="number">10</span>b672a..<span class="number">469</span>ce7c</span><br><span class="line">--- a/drivers/mtd/nand/sunxi_nand.c</span><br><span class="line">+++ b/drivers/mtd/nand/sunxi_nand.c</span><br><span class="line">@ -<span class="number">38</span>,<span class="number">7</span> +<span class="number">38</span>,<span class="number">7</span> @ <span class="keyword">int</span> sunxi_nand_read_opts(nand_info_t *nand, <span class="built_in">uint</span> offset, size_t *length,</span><br><span class="line">unsigned <span class="keyword">int</span> nSectNum,  nSectorCnt;</span><br><span class="line">- nSectNum = (unsigned <span class="keyword">int</span>)(offset / <span class="number">512</span>);</span><br><span class="line">+ nSectNum = (unsigned <span class="keyword">int</span>)(offset );</span><br><span class="line">nSectorCnt = (unsigned <span class="keyword">int</span>)(*length / <span class="number">512</span>);</span><br><span class="line">\#ifdef DEBUG</span><br><span class="line">printf(<span class="string">"sunxi nand read: start sector %x counts %x "</span>, nSectNum, nSectorCnt);</span><br><span class="line">@ -<span class="number">51</span>,<span class="number">7</span> +<span class="number">51</span>,<span class="number">7</span> @ <span class="keyword">int</span> sunxi_nand_write_opts(nand_info_t *nand, <span class="built_in">uint</span> offset, size_t *length,</span><br><span class="line">unsigned <span class="keyword">int</span> nSectNum,  nSectorCnt;</span><br><span class="line">- nSectNum = (unsigned <span class="keyword">int</span>)(offset / <span class="number">512</span>);</span><br><span class="line">+ nSectNum = (unsigned <span class="keyword">int</span>)(offset);</span><br><span class="line">nSectorCnt = (unsigned <span class="keyword">int</span>)(*length / <span class="number">512</span>);</span><br><span class="line">\#ifdef DEBUG</span><br><span class="line">printf(<span class="string">"sunxi nand write: start sector %x counts %x "</span>, nSectNum, nSectorCnt);</span><br><span class="line">diff --git a/drivers/storage_type/sunxi_flash.c b/drivers/storage_type/sunxi_flash.c</span><br><span class="line">index c78c392..<span class="number">2</span>c9cf17 <span class="number">100755</span></span><br><span class="line">--- a/drivers/storage_type/sunxi_flash.c</span><br><span class="line">+++ b/drivers/storage_type/sunxi_flash.c</span><br><span class="line">@ -<span class="number">66</span>,<span class="number">7</span> +<span class="number">66</span>,<span class="number">7</span> @ sunxi_flash_nand_read(unsigned <span class="keyword">int</span> start_block, unsigned <span class="keyword">int</span> nblock, <span class="keyword">void</span> *buffe</span><br><span class="line">tick_printf(FILE, LINE);</span><br><span class="line">        nsize = nblock&lt;&lt;<span class="number">9</span>;</span><br><span class="line">-       ret = sunxi_nand_read_opts(&amp;nand_info[<span class="number">0</span>], start_block&lt;&lt;<span class="number">9</span>, &amp;nsize, buffer, <span class="number">0</span>);</span><br><span class="line">+       ret = sunxi_nand_read_opts(&amp;nand_info[<span class="number">0</span>], start_block, &amp;nsize, buffer, <span class="number">0</span>);</span><br><span class="line">        tick_printf(FILE, LINE);</span><br><span class="line"><span class="keyword">return</span> ret;</span><br><span class="line">@ -<span class="number">77</span>,<span class="number">7</span> +<span class="number">77</span>,<span class="number">7</span> @ sunxi_flash_nand_write(unsigned <span class="keyword">int</span> start_block, unsigned <span class="keyword">int</span> nblock, <span class="keyword">void</span> *buff</span><br><span class="line">        unsigned <span class="keyword">int</span> nsize;</span><br><span class="line">nsize = nblock&lt;&lt;<span class="number">9</span>;</span><br><span class="line">-       <span class="keyword">return</span> sunxi_nand_write_opts(&amp;nand_info[<span class="number">0</span>], start_block&lt;&lt;<span class="number">9</span>, &amp;nsize, buffer, <span class="number">0</span>);</span><br><span class="line">+       <span class="keyword">return</span> sunxi_nand_write_opts(&amp;nand_info[<span class="number">0</span>], start_block, &amp;nsize, buffer, <span class="number">0</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h3 id="支持多用户功能"><a href="#支持多用户功能" class="headerlink" title="支持多用户功能"></a>支持多用户功能</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">integer</span> <span class="attr">name</span>=<span class="string">"config_multiuserMaximumUsers"</span>&gt;</span>8<span class="tag">&lt;/<span class="name">integer</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="在首次开机时默认将Play商店停用"><a href="#在首次开机时默认将Play商店停用" class="headerlink" title="在首次开机时默认将Play商店停用"></a>在首次开机时默认将Play商店停用</h3><p>修改：packages\apps\Provision，在这里将vending应用停用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">PackageManager pm = getPackageManager();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	pm.setApplicationEnabledSetting(<span class="string">"com.android.vending"</span>, 				PackageManager.COMPONENT_ENABLED_STATE_DISABLED_USER, <span class="number">0</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span>(Exception e) &#123;</span><br><span class="line">	android.util.Log.i(<span class="string">"chen"</span>, <span class="string">"change fail"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>并在Provision应用的AndroidManifest.xml中增加权限<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.CHANGE_COMPONENT_ENABLED_STATE"</span> /&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="4-1系统在播放视频时，视频切换会出现花屏："><a href="#4-1系统在播放视频时，视频切换会出现花屏：" class="headerlink" title="4.1系统在播放视频时，视频切换会出现花屏："></a>4.1系统在播放视频时，视频切换会出现花屏：</h3><p>在 device\softwinner\common\hardware\libhardware\hwcomposer\hwcomposer.cpp  里</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">hwc_show</span><span class="params">(sun4i_hwc_context_t *ctx,uint32_t value)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">	<span class="keyword">unsigned</span> <span class="keyword">long</span>               args[<span class="number">4</span>]=&#123;<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span>                screen_idx;</span><br><span class="line">    <span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">      <span class="keyword">for</span>(screen_idx=<span class="number">0</span>; screen_idx&lt;<span class="number">2</span>; screen_idx++)</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="keyword">if</span>(((screen_idx == <span class="number">0</span>) &amp;&amp; (ctx-&gt;mode==HWC_MODE_SCREEN0 || ctx-&gt;mode==HWC_MODE_SCREEN0_AND_SCREEN1 ))</span><br><span class="line">              || ((screen_idx == <span class="number">1</span>) &amp;&amp; (ctx-&gt;mode == HWC_MODE_SCREEN1 || ctx-&gt;mode==HWC_MODE_SCREEN0_TO_SCREEN1 || ctx-&gt;mode==HWC_MODE_SCREEN0_AND_SCREEN1)))</span><br><span class="line">          &#123;</span><br><span class="line">              <span class="keyword">if</span>(ctx-&gt;video_layerhdl[screen_idx] != <span class="number">0</span>)</span><br><span class="line">              &#123;</span><br><span class="line">                  <span class="keyword">if</span>(value == <span class="number">0</span>)</span><br><span class="line">                  &#123;</span><br><span class="line">                      args[<span class="number">0</span>]                         = screen_idx;</span><br><span class="line">                      args[<span class="number">1</span>]                         = ctx-&gt;video_layerhdl[screen_idx];</span><br><span class="line">                      ioctl(ctx-&gt;dispfd, DISP_CMD_LAYER_CLOSE,args);</span><br><span class="line"> </span><br><span class="line">                      args[<span class="number">0</span>]                         = screen_idx;</span><br><span class="line">                      args[<span class="number">1</span>]                         = ctx-&gt;video_layerhdl[screen_idx];</span><br><span class="line">                      ret = ioctl(ctx-&gt;dispfd, DISP_CMD_VIDEO_STOP, args);</span><br><span class="line"> </span><br><span class="line">                  &#125;</span><br><span class="line">                  <span class="keyword">else</span></span><br><span class="line">                  &#123;</span><br><span class="line">                      args[<span class="number">0</span>]                         = screen_idx;</span><br><span class="line">                      args[<span class="number">1</span>]                         = ctx-&gt;video_layerhdl[screen_idx];</span><br><span class="line">                      ioctl(ctx-&gt;dispfd, DISP_CMD_LAYER_OPEN,args);</span><br><span class="line"> </span><br><span class="line">                      args[<span class="number">0</span>]                         = screen_idx;</span><br><span class="line">                      args[<span class="number">1</span>]                         = ctx-&gt;video_layerhdl[screen_idx];</span><br><span class="line">                      ret = ioctl(ctx-&gt;dispfd, DISP_CMD_VIDEO_START, args);</span><br><span class="line">                  &#125;</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line"> </span><br><span class="line">   return ret;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在 hwc_setparameter 函数加上<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>(param == HWC_LAYER_SHOW)&#123;</span><br><span class="line">ret = hwc_show(ctx,value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="添加新的产品编译项："><a href="#添加新的产品编译项：" class="headerlink" title="添加新的产品编译项："></a>添加新的产品编译项：</h3><p>以abcd为例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cp -r crane-m1003h6 crane-abcd</span><br><span class="line"><span class="built_in">cd</span> crane-abcd</span><br><span class="line">grep -r <span class="_">-l</span> <span class="string">"m1003h6"</span> ./* | xargs sed -i <span class="string">'s/m1003h6/abcd/g'</span></span><br><span class="line">mv crane_m1003h6.mk crane_abcd.mk</span><br></pre></td></tr></table></figure>
<h3 id="播放Mp3，屏幕暗下去以后，调节音量键无效"><a href="#播放Mp3，屏幕暗下去以后，调节音量键无效" class="headerlink" title="播放Mp3，屏幕暗下去以后，调节音量键无效"></a>播放Mp3，屏幕暗下去以后，调节音量键无效</h3><p>去掉isScreenOn的判断</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">a/policy/src/com/android/internal/policy/impl/PhoneWindowManager.java</span><br><span class="line">+++ b/policy/src/com/android/internal/policy/impl/PhoneWindowManager.java</span><br><span class="line">@@ -<span class="number">3352</span>,<span class="number">7</span> +<span class="number">3352</span>,<span class="number">7</span> @@ <span class="keyword">public</span> <span class="keyword">class</span> PhoneWindowManager implements WindowManagerPolicy &#123;</span><br><span class="line">             <span class="keyword">case</span> KeyEvent.KEYCODE_VOLUME_MUTE: &#123;</span><br><span class="line">                 <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_VOLUME_DOWN) &#123;</span><br><span class="line">                     <span class="keyword">if</span> (down) &#123;</span><br><span class="line">-                        <span class="keyword">if</span> (isScreenOn &amp;&amp; !mVolumeDownKeyTriggered</span><br><span class="line">+                        <span class="keyword">if</span> (!mVolumeDownKeyTriggered</span><br><span class="line">                                 &amp;&amp; (event.getFlags() &amp; KeyEvent.FLAG_FALLBACK) == <span class="number">0</span>) &#123;</span><br><span class="line">                             mVolumeDownKeyTriggered = <span class="literal">true</span>;</span><br><span class="line">                             mVolumeDownKeyTime = event.getDownTime();</span><br><span class="line">@@ -<span class="number">3366</span>,<span class="number">7</span> +<span class="number">3366</span>,<span class="number">7</span> @@ <span class="keyword">public</span> <span class="keyword">class</span> PhoneWindowManager implements WindowManagerPolicy &#123;</span><br><span class="line">                     &#125;</span><br><span class="line">                 &#125; <span class="keyword">else</span> <span class="keyword">if</span> (keyCode == KeyEvent.KEYCODE_VOLUME_UP) &#123;</span><br><span class="line">                     <span class="keyword">if</span> (down) &#123;</span><br><span class="line">-                        <span class="keyword">if</span> (isScreenOn &amp;&amp; !mVolumeUpKeyTriggered</span><br><span class="line">+                        <span class="keyword">if</span> (!mVolumeUpKeyTriggered</span><br><span class="line">                                 &amp;&amp; (event.getFlags() &amp; KeyEvent.FLAG_FALLBACK) == <span class="number">0</span>) &#123;</span><br><span class="line">                             mVolumeUpKeyTriggered = <span class="literal">true</span>;</span><br><span class="line">                             cancelPendingPowerKeyAction();</span><br></pre></td></tr></table></figure>
<p>不让按键进入suspend</p>
<figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">--- a/drivers/input/keyboard/sun4i-keyboard.c</span><br><span class="line">+++ b/drivers/input/keyboard/sun4i-keyboard.c</span><br><span class="line">@@ -<span class="number">183</span>,<span class="number">7</span> +<span class="number">183</span>,<span class="number">7</span> @@ <span class="keyword">static</span> <span class="keyword">void</span> sun4i_keyboard_suspend(<span class="keyword">struct</span> early_suspend *h)</span><br><span class="line">     </span><br><span class="line">        <span class="keyword">if</span> (NORMAL_STANDBY == standby_type) &#123;</span><br><span class="line">\-               writel(<span class="number">0</span>,KEY_BASSADDRESS + LRADC_CTRL);</span><br><span class="line">\+               <span class="comment">//writel(0,KEY_BASSADDRESS + LRADC_CTRL);</span></span><br><span class="line">        <span class="comment">/*process for super standby*/</span>   </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span>(SUPER_STANDBY == standby_type) &#123;</span><br><span class="line">                ;</span><br><span class="line">@@ -<span class="number">466</span>,<span class="number">5</span> +<span class="number">466</span>,<span class="number">5</span> @@ MODULE_AUTHOR(<span class="string">" &lt;@&gt;"</span>);</span><br></pre></td></tr></table></figure>
<h3 id="Google-Play-搜不到某个应用"><a href="#Google-Play-搜不到某个应用" class="headerlink" title="Google Play 搜不到某个应用"></a>Google Play 搜不到某个应用</h3><p>google play搜不到某个应用的分析和解决方法</p>
<p>   搜不到应用是设备缺少该应用所必须的权限，即使安装了也可能出现部分功能不能正常使用的情况。如何让A1X搜到应用，下面以搜索IDTV应用为例：</p>
<ol>
<li>先在pc上打开google play搜到IDTV这个应用</li>
<li>查看这个应用所需要的权限，需要定位，WIFI等</li>
<li>查看设备所具有的权限etc/permissions/*</li>
<li>比较找到设备所缺少的权限，例如A10默认缺少IDTV所必须的定位权限。</li>
<li>将可疑的权限文件push到etc/permissions/下，恢复出厂设置再次测试能否搜到。</li>
<li>在项目中拷贝所需的权限，例如打开网络定位的功能。</li>
</ol>
<p>如果难以定位缺少所需的权限，其他手机可搜索到，比较etc/permissions/<em>下的内容，反复push，恢复出厂设置后测试。<br>所有权限文件路径：frameworks/native/data/etc/</em></p>
<h3 id="Google-Play-上下载的水果忍者运行出错"><a href="#Google-Play-上下载的水果忍者运行出错" class="headerlink" title="Google Play 上下载的水果忍者运行出错"></a>Google Play 上下载的水果忍者运行出错</h3><p>下载的水果忍者带有广告， 会请求定位服务。没有gps，所以要保证有网络定位功能。</p>
<p>请检查 config_networkLocationProvider 是否为 null</p>
<p>修改： </p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">string</span> <span class="attr">name</span>=<span class="string">"config_networkLocationProviderPackageName"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span>com.google.android.location<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="内存使用状态显示问题："><a href="#内存使用状态显示问题：" class="headerlink" title="内存使用状态显示问题："></a>内存使用状态显示问题：</h3><p>现象：<br>在settings-&gt;apps-&gt;观察internal storage 显示信息（有显示已用空间与可用空间的数值）-&gt;点击右边任意一个应用-&gt;返回-&gt;再观察 internal storage 显示信息（无已用空间与可用空间的数值显示）</p>
<p>解决方法：<br><figure class="highlight d"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">diff --git a/src/com/android/settings/applications/ManageApplications.java b/src/com/android/settings/applications/ManageApplications.java</span><br><span class="line">--- a/src/com/android/settings/applications/ManageApplications.java</span><br><span class="line">+++ b/src/com/android/settings/applications/ManageApplications.java</span><br><span class="line">@@ -<span class="number">855</span>,<span class="number">13</span> +<span class="number">855</span>,<span class="number">16</span> @@ <span class="keyword">public</span> <span class="keyword">class</span> ManageApplications extends Fragment implements</span><br><span class="line">mColorBar.setRatios((totalStorage-freeStorage-appStorage)/(<span class="built_in">float</span>)totalStorage,</span><br><span class="line">appStorage/(<span class="built_in">float</span>)totalStorage, freeStorage/(<span class="built_in">float</span>)totalStorage);</span><br><span class="line"><span class="built_in">long</span> usedStorage = totalStorage - freeStorage;</span><br><span class="line">- <span class="keyword">if</span> (mLastUsedStorage != usedStorage) &#123;</span><br><span class="line">+	</span><br><span class="line">+ <span class="comment">//if (mLastUsedStorage != usedStorage) &#123;</span></span><br><span class="line">+ <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">mLastUsedStorage = usedStorage;</span><br><span class="line">String sizeStr = Formatter.formatShortFileSize(getActivity(), usedStorage);</span><br><span class="line">mUsedStorageText.setText(getActivity().getResources().getString(</span><br><span class="line">R.<span class="built_in">string</span>.service_foreground_processes, sizeStr));</span><br><span class="line">&#125;</span><br><span class="line">- <span class="keyword">if</span> (mLastFreeStorage != freeStorage) &#123;</span><br><span class="line">+ <span class="comment">//if (mLastFreeStorage != freeStorage) &#123;</span></span><br><span class="line">+ <span class="keyword">if</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">mLastFreeStorage = freeStorage;</span><br><span class="line">String sizeStr = Formatter.formatShortFileSize(getActivity(), freeStorage);</span><br><span class="line">mFreeStorageText.setText(getActivity().getResources().getString(</span><br></pre></td></tr></table></figure></p>
<h3 id="隐藏状态栏："><a href="#隐藏状态栏：" class="headerlink" title="隐藏状态栏："></a>隐藏状态栏：</h3><p>如果有应用程序的源码，可以在需要隐藏状态栏的activity中添加</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">activity</span> <span class="attr">android:name</span>=<span class="string">"xxx"</span></span><br><span class="line">		  <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></span><br><span class="line">          <span class="attr">android:theme</span>=<span class="string">"@android:style/Theme.NoTitleBar.Fullscreen"</span> &gt;</span></span><br></pre></td></tr></table></figure>
<p>如果没有应用的源码，在PhoneWindowManager.java文件 finishAnimationLw函数中，针对特殊的应用判断。已有视频播放的参考代码，参照修改即可。</p>
<h3 id="预装APK过大，升级固件在一定百分比出错"><a href="#预装APK过大，升级固件在一定百分比出错" class="headerlink" title="预装APK过大，升级固件在一定百分比出错"></a>预装APK过大，升级固件在一定百分比出错</h3><p>可以试一下做如下修改</p>
<ol>
<li><p>修改 BoardConfig.mk<br>BOARD_SYSTEMIMAGE_PARTITION_SIZE 要比预装的总空间大。</p>
</li>
<li><p>通过更改devices/softwinner/crane_xx/package.sh如下</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mv out/target/product/crane-evb_mmc/system.img out/target/product/crane-evb_mmc/system.img_old</span><br><span class="line">simg2img out/target/product/crane-evb_mmc/system.img_old out/target/product/crane-evb_mmc/system.img</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$PACKAGE</span></span><br><span class="line">./pack -c sun4i -p crane -b evb_mmc</span><br><span class="line"><span class="built_in">cd</span> -</span><br></pre></td></tr></table></figure>
<h3 id="蓝牙可用设备会显示之前搜索到但已关闭的设备"><a href="#蓝牙可用设备会显示之前搜索到但已关闭的设备" class="headerlink" title="蓝牙可用设备会显示之前搜索到但已关闭的设备"></a>蓝牙可用设备会显示之前搜索到但已关闭的设备</h3><p>蓝牙的缓存管理CachedBluetoothDeviceManager中， 只有添加设备， 没有清除。</p>
<p>修改如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在CachedBluetoothDeviceManager中添加删除接口</span></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">removeAllCacheDevices</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123;</span><br><span class="line">                List&lt;CachedBluetoothDevice&gt; mCachedList = mCachedDevices;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = mCachedList.size() - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">                    mCachedList.remove(mCachedList.get(<span class="number">0</span>));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="comment">//在startScanning的地方调用，调用方式</span></span><br><span class="line">         mLocalManager = LocalBluetoothManager.getInstance(context);</span><br><span class="line">         <span class="keyword">if</span> (mLocalManager == <span class="keyword">null</span>) &#123;</span><br><span class="line">             Log.e(TAG, <span class="string">"Bluetooth is not supported on this device"</span>);</span><br><span class="line">             <span class="keyword">return</span>;</span><br><span class="line">         &#125;</span><br><span class="line">   mLocalManager.getCachedDeviceManager().removeAllCacheDevices();</span><br></pre></td></tr></table></figure>
<h3 id="修改Launcher显示的列数"><a href="#修改Launcher显示的列数" class="headerlink" title="修改Launcher显示的列数"></a>修改Launcher显示的列数</h3><p>将Launcher修改为7列, 如下两种方法均可.</p>
<p>方法1: workspace.xml 文件中, 在 launcher:defaultScreen=”2” 的下面增加一行: launcher:cellCountX=”7”</p>
<p>方法2: dimens.xml 文件中, 修改workspace_cell_width的值. 改小, 使屏幕宽度除以这个值大于7.</p>
<h3 id="状态栏的日期格式不随设置的日期格式改变"><a href="#状态栏的日期格式不随设置的日期格式改变" class="headerlink" title="状态栏的日期格式不随设置的日期格式改变"></a>状态栏的日期格式不随设置的日期格式改变</h3><p>修改如下:<br>文件: frameworks\base\packages\SystemUI\src\com\android\systemui\statusbar\policy\DateView.java<br>函数: updateClock<br>CharSequence date = DateFormat.getLongDateFormat(context).format(now); // java语言长日期格式<br>改为<br>CharSequence date = DateFormat.getDateFormat(context).format(now);  // 从设置读取日期格式</p>
<h3 id="超请播放器分享功能相关问题"><a href="#超请播放器分享功能相关问题" class="headerlink" title="超请播放器分享功能相关问题"></a>超请播放器分享功能相关问题</h3><p>现象：<br>在A13的1.5版本上，客户在美国那边发现在超清播放器里面图片分享的功能，如果只安装了gmail或者email的时候无法使用，但是安装了比如facebook、twitter这些东西之后就可以使用了</p>
<p>解决方法：<br>在 frameworks\base\core\java\android\widget\ActivityChooserView.java<br> public ActivityChooserView(Context context, AttributeSet attrs, int defStyle) {  这个函数大概 239 行，</p>
<p> mAdapter = new ActivityChooserViewAdapter(); 加上</p>
<p> mAdapter.setShowFooterView(true);</p>
<h3 id="Google-Chrome-进Setting-停止运行"><a href="#Google-Chrome-进Setting-停止运行" class="headerlink" title="Google Chrome 进Setting 停止运行"></a>Google Chrome 进Setting 停止运行</h3><p>现象：<br>通过play store下载安装Google Chrome。打开该浏览器，点右上角菜单，选择“Settings”，出现停止运行提示。</p>
<p>解决方法：<br>与尺寸有关,小尺寸有问题.使用的preference_headers.xml不同.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//修改文件 frameworks\base\core\java\android\preference\PreferenceActivity.java</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Header <span class="title">onGetInitialHeader</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 添加这个for循环</span></span><br><span class="line">    <span class="keyword">for</span> (Header h : mHeaders) &#123;</span><br><span class="line">            <span class="keyword">if</span> (h.fragment != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">return</span> h;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> mHeaders.get(<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="升级后首次开机不显示音量图标"><a href="#升级后首次开机不显示音量图标" class="headerlink" title="升级后首次开机不显示音量图标"></a>升级后首次开机不显示音量图标</h3><p>现象：<br>升级后首次开机需要先待机锁屏再解锁，才能显示音量图标</p>
<p>解决方法：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在 TabletStatusBar.java 文件的 makeStatusBarView 函数中,</span></span><br><span class="line">mVolumeDownButton = mNavigationArea.findViewById(R.id.volume_down);</span><br><span class="line">mVolumeUpButton = mNavigationArea.findViewById(R.id.volume_up);</span><br><span class="line"><span class="comment">// 增加下面这个if分支</span></span><br><span class="line"><span class="keyword">if</span>(mContext.getResources().getBoolean(R.bool.hasVolumeButton))</span><br><span class="line">&#123;</span><br><span class="line">mVolumeUpButton.setVisibility(View.VISIBLE);</span><br><span class="line">mVolumeDownButton.setVisibility(View.VISIBLE);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="视频实时旋转"><a href="#视频实时旋转" class="headerlink" title="视频实时旋转"></a>视频实时旋转</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//1.frameworks\base\services\surfaceflinger\SurfaceTextureLayer.cpp 中修改一下函数</span></span><br><span class="line">uint32_t SurfaceTextureLayer::getParameter(uint32_t cmd) </span><br><span class="line">&#123;</span><br><span class="line">    uint32_t res = <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line"><span class="comment">/* if(cmd == NATIVE_WINDOW_CMD_GET_SURFACE_TEXTURE_TYPE) &#123;</span><br><span class="line">return 1;</span><br><span class="line">&#125;</span><br><span class="line">*/</span> </span><br><span class="line">    <span class="function">sp&lt;Layer&gt; <span class="title">layer</span><span class="params">(mLayer.promote()</span>)</span>;</span><br><span class="line">    <span class="keyword">if</span> (layer != NULL) </span><br><span class="line">    &#123;</span><br><span class="line">        res = layer-&gt;getDisplayParameter(cmd);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> res;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//2.在frameworks\base\policy\src\com\android\internal\policy\impl\PhoneWindowManager.java  中</span></span><br><span class="line">rotationForOrientationLw() 函数里 注释掉多余的</span><br><span class="line"><span class="comment">// if(MediaPlayer.isPlayingVideo())</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">// Log.i(TAG, "MediaPlayer.isPlayingVideo");</span></span><br><span class="line"><span class="comment">// if(SystemProperties.getInt("ro.sf.hwrotation",0)==270)</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">// sensorRotation = Surface.ROTATION_90;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// else</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">// sensorRotation = Surface.ROTATION_0;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// else</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line">Log.i(TAG, <span class="string">"MediaPlayer.is not PlayingVideo"</span>);</span><br><span class="line">sensorRotation = mOrientationListener.getProposedRotation(); <span class="comment">// may be -1</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 3.修改 packages\apps\Gallery2\AndroidManifest.xml  修改</span></span><br><span class="line">        &lt;activity android:name=<span class="string">"com.android.gallery3d.app.MovieActivity"</span></span><br><span class="line">                android:label=<span class="string">"@string/movie_view_label"</span></span><br><span class="line">android:configChanges=<span class="string">"keyboardHidden|orientation"</span></span><br><span class="line">                android:theme=<span class="string">"@style/Theme.Movie"</span> &gt;</span><br></pre></td></tr></table></figure>
<h3 id="开启wifi连3G会出现wifi和3G两个图标，退出3G后3G图标不消失"><a href="#开启wifi连3G会出现wifi和3G两个图标，退出3G后3G图标不消失" class="headerlink" title="开启wifi连3G会出现wifi和3G两个图标，退出3G后3G图标不消失"></a>开启wifi连3G会出现wifi和3G两个图标，退出3G后3G图标不消失</h3><p>修改如红色代码所示：</p>
<p>./frameworks/base/packages/SystemUI/src/com/android/systemui/statusbar/policy/NetworkController.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">refreshViews</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       Context context = mContext;</span><br><span class="line">       <span class="keyword">int</span> combinedSignalIconId = <span class="number">0</span>;</span><br><span class="line">       <span class="keyword">int</span> combinedActivityIconId = <span class="number">0</span>;</span><br><span class="line">       String combinedLabel = <span class="string">""</span>;</span><br><span class="line">       String wifiLabel = <span class="string">""</span>;</span><br><span class="line">       String mobileLabel = <span class="string">""</span>;</span><br><span class="line">       <span class="keyword">int</span> N;</span><br><span class="line">        <span class="keyword">if</span> (mWifiConnected &amp;&amp; !mDataConnected) &#123;</span><br><span class="line">            mDataSignalIconId = mPhoneSignalIconId = <span class="number">0</span>;</span><br><span class="line">           mobileLabel = <span class="string">""</span>;</span><br><span class="line">       &#125;</span><br><span class="line"> </span><br><span class="line">     <span class="keyword">if</span> (!mHasMobileDataFeature) &#123;</span><br><span class="line">           mDataSignalIconId = mPhoneSignalIconId = <span class="number">0</span>;</span><br><span class="line">           mobileLabel = <span class="string">""</span>;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br></pre></td></tr></table></figure>
<h3 id="解锁界面应用图标特大"><a href="#解锁界面应用图标特大" class="headerlink" title="解锁界面应用图标特大"></a>解锁界面应用图标特大</h3><p>frameworks\base\core\java\com\android\internal\widget\multiwaveview\MultiWaveView.java<br>把下面代码红色部分注释掉</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTargetResources</span><span class="params">(ArrayList&lt;Drawable&gt; drawables)</span></span>&#123;       Resources res = getContext().getResources();       <span class="keyword">int</span> count = drawables.size();  Drawable drawable = <span class="keyword">null</span>;       ArrayList&lt;TargetDrawable&gt; targetDrawables = <span class="keyword">new</span> ArrayList&lt;TargetDrawable&gt;(count);  <span class="keyword">if</span>(count &gt; mMaxAppIconNum)  count = mMaxAppIconNum;        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;<span class="keyword">if</span>(i!=<span class="number">0</span>)&#123;            drawable = zoomDrawable(drawables.get(i),mIconSize,mIconSize);&#125;<span class="keyword">else</span>&#123;   drawable = drawables.get(i);&#125;  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTargetResources</span><span class="params">(ArrayList&lt;Drawable&gt; drawables)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">Resources res = getContext().getResources();</span><br><span class="line"><span class="keyword">int</span> count = drawables.size();</span><br><span class="line">Drawable drawable = <span class="keyword">null</span>;</span><br><span class="line"> ArrayList&lt;TargetDrawable&gt; targetDrawables = <span class="keyword">new</span> ArrayList&lt;TargetDrawable&gt;(count);</span><br><span class="line"><span class="keyword">if</span>(count &gt; mMaxAppIconNum)</span><br><span class="line">count = mMaxAppIconNum;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line"><span class="comment">// if(i!=0)</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">// drawable = zoomDrawable(drawables.get(i),mIconSize,mIconSize);</span></span><br><span class="line"><span class="comment">// &#125;else</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line">drawable = drawables.get(i);</span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="高清播放器图片预览时，不是居中"><a href="#高清播放器图片预览时，不是居中" class="headerlink" title="高清播放器图片预览时，不是居中"></a>高清播放器图片预览时，不是居中</h3><p>修改<br> packages\apps\Gallery2\src\com\android\gallery3d\ui\SlideshowView.java  </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">apply</span><span class="params">(GLCanvas canvas)</span> </span>&#123;</span><br><span class="line"><span class="comment">//            float centerX = viewWidth / 2 + mMovingVector.x * mProgress;//            float centerY = viewHeight / 2 + mMovingVector.y * mProgress;                        float centerX = viewWidth / 2 ;            float centerY = viewHeight / 2 ;//            float centerX = viewWidth / 2 + mMovingVector.x * mProgress;//            float centerY = viewHeight / 2 + mMovingVector.y * mProgress;                        float centerX = viewWidth / 2 ;            float centerY = viewHeight / 2 ;约 152 行</span></span><br><span class="line">    <span class="comment">// float centerX = viewWidth / 2 + mMovingVector.x * mProgress;</span></span><br><span class="line">   <span class="comment">//  float centerY = viewHeight / 2 + mMovingVector.y * mProgress;</span></span><br><span class="line">  <span class="keyword">float</span> centerX = viewWidth / <span class="number">2</span> ;</span><br><span class="line">  <span class="keyword">float</span> centerY = viewHeight / <span class="number">2</span> ;</span><br></pre></td></tr></table></figure>
<h3 id="休眠间歇性唤醒"><a href="#休眠间歇性唤醒" class="headerlink" title="休眠间歇性唤醒"></a>休眠间歇性唤醒</h3><p>现象：<br>在standby时，系统间歇性会被唤醒</p>
<p>解决方法：<br>由于android本身timer机制导致，可以通过如下配置进行优化：</p>
<ol>
<li>进入menuconfig</li>
<li>选择device drivers -&gt; real time clock</li>
<li>选择android alarm clock wakeup</li>
</ol>
<h3 id="音乐播放器中，均衡器界面不起作用"><a href="#音乐播放器中，均衡器界面不起作用" class="headerlink" title="音乐播放器中，均衡器界面不起作用"></a>音乐播放器中，均衡器界面不起作用</h3><p>现象：<br>音乐播放器，选择 ‘音效’ ，出现 均衡器 界面，界面上所有操作都不起作用</p>
<p>解决方法：<br>修改<br>packages\apps\MusicFX\src\com\android\musicfx\ActivityMusic.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onResume</span><span class="params">()</span> </span>&#123; </span><br><span class="line"><span class="comment">//中 460 行 </span></span><br><span class="line">\\ mIsHeadsetOn = (audioManager.isWiredHeadsetOn() || audioManager.isBluetoothA2dpOn());</span><br><span class="line"><span class="comment">// 改为 mIsHeadsetOn = true;</span></span><br><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateUI</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="comment">//中 551 行</span></span><br><span class="line"><span class="comment">/**</span><br><span class="line">final boolean isEnabled = ControlPanelEffect.getParameterBoolean(mContext,                mCallingPackageName, mAudioSession, ControlPanelEffect.Key.global_enabled);final boolean isEnabled = ControlPanelEffect.getParameterBoolean(mContext,                mCallingPackageName, mAudioSession, ControlPanelEffect.Key.global_enabled);final boolean isEnabled = ControlPanelEffect.getParameterBoolean(mContext,                mCallingPackageName, mAudioSession, ControlPanelEffect.Key.global_enabled);  * final boolean isEnabled = ControlPanelEffect.getParameterBoolean(mContext,</span><br><span class="line">* mCallingPackageName, mAudioSession, ControlPanelEffect.Key.global_enabled);</span><br><span class="line">**/</span></span><br><span class="line"><span class="comment">// 改为</span></span><br><span class="line">  <span class="keyword">final</span> <span class="keyword">boolean</span> isEnabled = ControlPanelEffect.getParameterBoolean(mContext,</span><br><span class="line"> mCallingPackageName, mAudioSession, ControlPanelEffect.Key.virt_enabled);</span><br></pre></td></tr></table></figure></p>
<h3 id="修改播放器拖动时的状态条宽度"><a href="#修改播放器拖动时的状态条宽度" class="headerlink" title="修改播放器拖动时的状态条宽度"></a>修改播放器拖动时的状态条宽度</h3><p>修改<br>android4.0\packages\apps\Gallery2\res\layout\media_status.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">SeekBar</span>            <span class="attr">android:id</span>=<span class="string">"@+id/mediacontroller_progress"</span>            <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyleHorizontal"</span>            <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span>            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>            <span class="attr">android:paddingTop</span>=<span class="string">"30dp"</span>            <span class="attr">android:layout_height</span>=<span class="string">"60dip"</span> /&gt;</span>        <span class="tag">&lt;<span class="name">SeekBar</span>            <span class="attr">android:id</span>=<span class="string">"@+id/mediacontroller_progress"</span>            <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyleHorizontal"</span>            <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span>            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>            <span class="attr">android:paddingTop</span>=<span class="string">"30dp"</span>            <span class="attr">android:layout_height</span>=<span class="string">"60dip"</span> /&gt;</span>        <span class="tag">&lt;<span class="name">SeekBar</span>            <span class="attr">android:id</span>=<span class="string">"@+id/mediacontroller_progress"</span>            <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyleHorizontal"</span>            <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span>            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>            <span class="attr">android:paddingTop</span>=<span class="string">"30dp"</span>            <span class="attr">android:layout_height</span>=<span class="string">"60dip"</span> /&gt;</span>        <span class="tag">&lt;<span class="name">SeekBar</span>            <span class="attr">android:id</span>=<span class="string">"@+id/mediacontroller_progress"</span>            <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyleHorizontal"</span>            <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span>            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>            <span class="attr">android:paddingTop</span>=<span class="string">"30dp"</span>            <span class="attr">android:layout_height</span>=<span class="string">"60dip"</span> /&gt;</span>        <span class="tag">&lt;<span class="name">SeekBar</span>            <span class="attr">android:id</span>=<span class="string">"@+id/mediacontroller_progress"</span>            <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyleHorizontal"</span>            <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span>            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>            <span class="attr">android:paddingTop</span>=<span class="string">"30dp"</span>            <span class="attr">android:layout_height</span>=<span class="string">"60dip"</span> /&gt;</span>        <span class="tag">&lt;<span class="name">SeekBar</span>            <span class="attr">android:id</span>=<span class="string">"@+id/mediacontroller_progress"</span>            <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyleHorizontal"</span>            <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span>            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>            <span class="attr">android:paddingTop</span>=<span class="string">"30dp"</span>            <span class="attr">android:layout_height</span>=<span class="string">"60dip"</span> /&gt;</span>        <span class="tag">&lt;<span class="name">SeekBar</span>            <span class="attr">android:id</span>=<span class="string">"@+id/mediacontroller_progress"</span>            <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyleHorizontal"</span>            <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span>            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>            <span class="attr">android:paddingTop</span>=<span class="string">"30dp"</span>            <span class="attr">android:layout_height</span>=<span class="string">"60dip"</span> /&gt;</span>        <span class="tag">&lt;<span class="name">SeekBar</span>            <span class="attr">android:id</span>=<span class="string">"@+id/mediacontroller_progress"</span>            <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyleHorizontal"</span>            <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span>            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>            <span class="attr">android:paddingTop</span>=<span class="string">"30dp"</span>            <span class="attr">android:layout_height</span>=<span class="string">"60dip"</span> /&gt;</span>        <span class="tag">&lt;<span class="name">SeekBar</span>            <span class="attr">android:id</span>=<span class="string">"@+id/mediacontroller_progress"</span>            <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyleHorizontal"</span>            <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span>            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>            <span class="attr">android:paddingTop</span>=<span class="string">"30dp"</span>            <span class="attr">android:layout_height</span>=<span class="string">"60dip"</span> /&gt;</span>        <span class="tag">&lt;<span class="name">SeekBar</span>            <span class="attr">android:id</span>=<span class="string">"@+id/mediacontroller_progress"</span>            <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyleHorizontal"</span>            <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span>            <span class="attr">android:layout_weight</span>=<span class="string">"1"</span>            <span class="attr">android:paddingTop</span>=<span class="string">"30dp"</span>            <span class="attr">android:layout_height</span>=<span class="string">"60dip"</span> /&gt;</span><span class="tag">&lt;<span class="name">SeekBar</span></span><br><span class="line"> <span class="attr">android:id</span>=<span class="string">"@+id/mediacontroller_progress"</span></span><br><span class="line"> <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyleHorizontal"</span></span><br><span class="line"> <span class="attr">android:layout_width</span>=<span class="string">"0dip"</span></span><br><span class="line"><span class="attr">android:layout_weight</span>=<span class="string">"1"</span></span><br><span class="line"><span class="attr">android:paddingTop</span>=<span class="string">"30dp"</span></span><br><span class="line"><span class="attr">android:layout_height</span>=<span class="string">"60dip"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>数值根据需要进行调整。</p>
<h3 id="Music播放器无法点击前一首"><a href="#Music播放器无法点击前一首" class="headerlink" title="Music播放器无法点击前一首"></a>Music播放器无法点击前一首</h3><p>修改 android4.0\packages\apps\Music\src\com\android\music\MediaPlaybackActivity.java<br> 431行 onClick（）函数里<br> <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (mService == <span class="keyword">null</span>) <span class="keyword">return</span>;</span><br><span class="line">           <span class="keyword">try</span> &#123;</span><br><span class="line">                   mService.prev();</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">catch</span> (RemoteException ex) &#123;</span><br><span class="line">           &#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Google拼音输入法，横屏时有些应用没有中文选项"><a href="#Google拼音输入法，横屏时有些应用没有中文选项" class="headerlink" title="Google拼音输入法，横屏时有些应用没有中文选项"></a>Google拼音输入法，横屏时有些应用没有中文选项</h3><p>现象：</p>
<p>google拼音版本1.2版. 在launcher自定义文件夹名称, email输入邮件主题等横屏输入中文时, 不显示中文候选框, 无法输入.</p>
<p>解决方法：</p>
<p>在横屏时全屏来输入, 去掉相应布局文件中的 android:imeOptions=”flagNoExtractUi”.</p>
<h3 id="播放电影字幕与菜单重叠"><a href="#播放电影字幕与菜单重叠" class="headerlink" title="播放电影字幕与菜单重叠"></a>播放电影字幕与菜单重叠</h3><p>现象：</p>
<p>播放外带字幕电影，播放电影且已有字幕出现在屏幕上时触摸屏幕调出子菜单，字幕和菜单重叠，下一条字幕出现时则恢复正常。</p>
<p>解决方法：</p>
<p>修改 Gallery2\src\com\android\gallery3d\app\MediaController.java  在initControllerView  函数最后加 mUpSubPos += 10; 即可</p>
<h3 id="卡启动，Nand分区识别"><a href="#卡启动，Nand分区识别" class="headerlink" title="卡启动，Nand分区识别"></a>卡启动，Nand分区识别</h3><p>现象：</p>
<p>卡启动时，如何识别到nand并对其进行操作</p>
<p>解决方法：</p>
<p>关于要在卡启动识别到nand，有两种情况：</p>
<ol>
<li>nand上已经有分区；</li>
<li><p>nand是裸片；</p>
<p>第一种情况下卡启动时nand驱动能够初始化成功，用户可以通过mount命令挂载nand的分区；<br>第二种情况下要先给nand一个虚拟的mbr，使得启动时nand能够初始化成功，<br>可以通过修改nand驱动的源码达到这一目的。</p>
<p>A10平台修改linux-3.0/drivers/block/sun4i_nand/nfd/mbr.c<br>A1X平台修改linux-3.0/drivers/block/sun5i_nand/nfd/mbr.c</p>
</li>
</ol>
<p>具体改动如下：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">mbr2disks</span><span class="params">(<span class="keyword">struct</span> nand_disk* disk_array)</span></span><br><span class="line"></span>&#123;</span><br><span class="line">         <span class="keyword">int</span> part_cnt = <span class="number">0</span>;</span><br><span class="line">         <span class="keyword">int</span> part_index;</span><br><span class="line">\<span class="meta">#<span class="meta-keyword">if</span> 0</span></span><br><span class="line">         <span class="keyword">if</span>(_get_mbr())&#123;</span><br><span class="line">                   printk(<span class="string">"get mbr error\n"</span> );</span><br><span class="line">                   return part_cnt;</span><br><span class="line">         &#125;</span><br><span class="line">         part_index = <span class="number">0</span>;</span><br><span class="line"> </span><br><span class="line">         <span class="keyword">for</span>(part_cnt = <span class="number">0</span>; part_cnt&lt;MAX_PART_COUNT; part_cnt++)</span><br><span class="line">                   part_secur[part_index] = <span class="number">0</span>;       </span><br><span class="line">         <span class="comment">//查找出所有的LINUX盘符</span></span><br><span class="line">         <span class="keyword">for</span>(part_cnt = <span class="number">0</span>; part_cnt &lt; mbr-&gt;PartCount &amp;&amp; part_cnt &lt; MAX_PART_COUNT; part_cnt++)</span><br><span class="line">         &#123;</span><br><span class="line">             <span class="comment">//if((mbr-&gt;array[part_cnt].user_type == 2) || (mbr-&gt;array[part_cnt].user_type == 0))</span></span><br><span class="line">             &#123;</span><br><span class="line">                            PRINT(<span class="string">"The %d disk name = %s, class name = %s, disk size = %d\n"</span>, part_index, mbr-&gt;<span class="built_in">array</span>[part_cnt].name,</span><br><span class="line">                             mbr-&gt;<span class="built_in">array</span>[part_cnt].classname, mbr-&gt;<span class="built_in">array</span>[part_cnt].lenlo);</span><br><span class="line">                            disk_array[part_index].offset = mbr-&gt;<span class="built_in">array</span>[part_cnt].addrlo;</span><br><span class="line">                            disk_array[part_index].size = mbr-&gt;<span class="built_in">array</span>[part_cnt].lenlo;</span><br><span class="line">                            part_secur[part_index] = mbr-&gt;<span class="built_in">array</span>[part_cnt].user_type;</span><br><span class="line">                            part_index ++;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;</span><br><span class="line">         disk_array[part_index - <span class="number">1</span>].size = DiskSize - mbr-&gt;<span class="built_in">array</span>[mbr-&gt;PartCount - <span class="number">1</span>].addrlo;</span><br><span class="line">         _free_mbr();</span><br><span class="line">         PRINT(<span class="string">"The %d disk size = %lu\n"</span>, part_index - <span class="number">1</span>, disk_array[part_index - <span class="number">1</span>].size);</span><br><span class="line">         PRINT(<span class="string">"part total count = %d\n"</span>, part_index);</span><br><span class="line">\<span class="meta">#<span class="meta-keyword">else</span></span></span><br><span class="line">         part_index = <span class="number">1</span>;</span><br><span class="line">         disk_array[<span class="number">0</span>].offset = <span class="number">0</span>;</span><br><span class="line">         disk_array[<span class="number">0</span>].size = DiskSize;</span><br><span class="line">         part_secur[<span class="number">0</span>] = <span class="number">0</span>;</span><br><span class="line">\<span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line">         return part_index;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Android4-0-蓝牙键盘不能用"><a href="#Android4-0-蓝牙键盘不能用" class="headerlink" title="Android4.0 蓝牙键盘不能用"></a>Android4.0 蓝牙键盘不能用</h3><p>在menuconfig中，打开HIDP protocol support选项为y</p>
<h3 id="让多台机器公用一个下载帐号"><a href="#让多台机器公用一个下载帐号" class="headerlink" title="让多台机器公用一个下载帐号"></a>让多台机器公用一个下载帐号</h3><p>将授权机器的密钥文件（id_rsa和id_rsa.pub）copy到新机器用户目录下面的.ssh文件夹里，如果没有就新建。<br>同时将相关文件的权限进行修改：<br>owner  和group 设置成新机器上的用户<br>id_rsa文件权限设置成600</p>
<h3 id="高清播放器删除最后一张图片，图片再无法移动"><a href="#高清播放器删除最后一张图片，图片再无法移动" class="headerlink" title="高清播放器删除最后一张图片，图片再无法移动"></a>高清播放器删除最后一张图片，图片再无法移动</h3><p>改 Gallery2\src\com\android\gallery3d\ui\PhotoView.java </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startSlideInAnimation</span><span class="params">(<span class="keyword">int</span> direction)</span> </span>&#123;</span><br><span class="line">...</span><br><span class="line">        mTransitionMode = direction; 改成  mTransitionMode = TRANS_NONE;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="在系统中去掉蓝牙相关功能"><a href="#在系统中去掉蓝牙相关功能" class="headerlink" title="在系统中去掉蓝牙相关功能"></a>在系统中去掉蓝牙相关功能</h3><p>现象：</p>
<p>小机不带蓝牙功能，但系统自带的widget上有蓝牙选项，该如何去掉？</p>
<p>解决方法：</p>
<p>在android4.0\device\softwinner\crane-common\tablet_core_hardware.xml中<br>注释掉<br><figure class="highlight xml"><figcaption><span><feature name="android.hardware.bluetooth" <="" span=""><a href="/>">```</a></feature></span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### 默认竖屏模式下，高清播放器休眠后自动播放视频</span><br><span class="line"></span><br><span class="line">现象：</span><br><span class="line"></span><br><span class="line">默认竖屏模式下，高清播放器休眠后自动播放视频</span><br><span class="line"></span><br><span class="line">解决方法：</span><br><span class="line"></span><br><span class="line">由于播放器，不支持竖屏模式，所以休眠之后，由于横竖屏切换，导致播放器再次运行 可以适当的延长播放器的暂停时间，以回避这问题。 packages\apps\Gallery2\src\com\android\gallery3d\app\MovieActivity.java</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">import android.os.PowerManager; </span><br><span class="line">import android.content.Context; </span><br><span class="line">import android.os.SystemClock;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">private PowerManager mPowerManager; </span><br><span class="line">@Override</span><br><span class="line">public void onCreate(Bundle icicle) &#123;</span><br><span class="line">	mPowerManager = (PowerManager)getApplicationContext().getSystemService(Context.POWER_SERVICE); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void onPause() &#123;  </span><br><span class="line">	if(mPowerManager != null)&#123; </span><br><span class="line">		if(!mPowerManager.isScreenOn())&#123; </span><br><span class="line">			SystemClock.sleep(1000);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	mControl.onPause();super.onPause();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="字体为超大时，竖屏在解锁界面，解锁的图标显示不全"><a href="#字体为超大时，竖屏在解锁界面，解锁的图标显示不全" class="headerlink" title="字体为超大时，竖屏在解锁界面，解锁的图标显示不全"></a>字体为超大时，竖屏在解锁界面，解锁的图标显示不全</h3><p>现象：</p>
<p>800x600,lcd_denisty 160</p>
<p>解决方法：</p>
<p>frameworks/base/core/res/res/layout-sw600dp/keyguard_screen_tab_unlock.xml</p>
<p>适当加大72行的android:layout_weight=”1”</p>
<p>这样解锁部分的面积会增加，解决这个问题</p>
<p>其他分辨率需要修改其他layout文件夹下的keyguard_screen_tab_unlock.xml</p>
<h3 id="音效里的Normal和Flat功能反"><a href="#音效里的Normal和Flat功能反" class="headerlink" title="音效里的Normal和Flat功能反"></a>音效里的Normal和Flat功能反</h3><p>frameworks/base/media/libeffects/lvm/wrapper/Bundle/EffectBundle.h</p>
<p>gEqualizerPresets数组,名字可以随意修改</p>
<h3 id="动态壁纸，线性光幕效果有黑块"><a href="#动态壁纸，线性光幕效果有黑块" class="headerlink" title="动态壁纸，线性光幕效果有黑块"></a>动态壁纸，线性光幕效果有黑块</h3><p>效果：</p>
<p>将壁纸设为动态壁纸中的“线性光幕效果”时，在主界面旋转屏幕时未显示完整，即往边上拉存在黑块问题。</p>
<p>解决方法：</p>
<p>修改：<br>android\packages\wallpapers\Basic\src\com\android\wallpaper\nexus\NexusRS.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOffset</span><span class="params">(<span class="keyword">float</span> xOffset, <span class="keyword">float</span> yOffset, <span class="keyword">int</span> xPixels, <span class="keyword">int</span> yPixels)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//mXOffset = xOffset; </span></span><br><span class="line">    <span class="comment">//mScript.set_gXOffset(xOffset);</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="修改Setting里面各字体对应的大小"><a href="#修改Setting里面各字体对应的大小" class="headerlink" title="修改Setting里面各字体对应的大小"></a>修改Setting里面各字体对应的大小</h3><p>现象：</p>
<p>感觉setting里面字体大小选择的变化幅度太大，希望小不要太小，特大不要太大，每级变化的幅度缩小点该如何修改</p>
<p>解决方法：</p>
<p>android4.0\packages\apps\Settings\res\values\arrays.xml 文件里</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">"entryvalues_font_size"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>0.85<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.15<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.30<span class="tag">&lt;/<span class="name">item</span>&gt;</span>    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span>    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">"entryvalues_font_size"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>0.85<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.15<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.30<span class="tag">&lt;/<span class="name">item</span>&gt;</span>    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span>    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">"entryvalues_font_size"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>0.85<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.15<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.30<span class="tag">&lt;/<span class="name">item</span>&gt;</span>    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span>    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">"entryvalues_font_size"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>0.85<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.15<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.30<span class="tag">&lt;/<span class="name">item</span>&gt;</span>    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span>    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">"entryvalues_font_size"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>0.85<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.15<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.30<span class="tag">&lt;/<span class="name">item</span>&gt;</span>    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span>    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">"entryvalues_font_size"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>0.85<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.15<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.30<span class="tag">&lt;/<span class="name">item</span>&gt;</span>    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span>    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">"entryvalues_font_size"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>0.85<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.15<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.30<span class="tag">&lt;/<span class="name">item</span>&gt;</span>    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span>    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">"entryvalues_font_size"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>0.85<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.15<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.30<span class="tag">&lt;/<span class="name">item</span>&gt;</span>    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span>    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">"entryvalues_font_size"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>0.85<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.15<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.30<span class="tag">&lt;/<span class="name">item</span>&gt;</span>    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span>    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">"entryvalues_font_size"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>0.85<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.15<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.30<span class="tag">&lt;/<span class="name">item</span>&gt;</span>    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span>    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">"entryvalues_font_size"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>0.85<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.15<span class="tag">&lt;/<span class="name">item</span>&gt;</span>        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.30<span class="tag">&lt;/<span class="name">item</span>&gt;</span>    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span>    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">"entryvalues_font_size"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>0.85<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.15<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.30<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span></span><br><span class="line">默认是0.15的梯度 改成合适的梯度如</span><br><span class="line">    <span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">"entryvalues_font_size"</span> <span class="attr">translatable</span>=<span class="string">"false"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>0.90<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.10<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">item</span>&gt;</span>1.20<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">string-array</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="浏览器为Android模式时在线看视频卡"><a href="#浏览器为Android模式时在线看视频卡" class="headerlink" title="浏览器为Android模式时在线看视频卡"></a>浏览器为Android模式时在线看视频卡</h3><p>现象：</p>
<p>A10</p>
<ol>
<li>在浏览时有时偶尔会退出</li>
<li>浏览器用android模式，看在线视频十几分钟左右后会卡，但用ipad模式不会卡</li>
</ol>
<p>问题分析：</p>
<ol>
<li>需要具体分析问题，我们其它客户案上浏览正常</li>
<li>android模式采用的flash格式播放，而ipad采用的html5。flash由于自身格式和片源分割的关系，在线视频有机率产生不同步或卡顿问题。该问题由flash自身引起，这也是为何flash会逐渐被html5取代的一个方面。</li>
</ol>
<h3 id="Android2-3上开启U盘自扫描"><a href="#Android2-3上开启U盘自扫描" class="headerlink" title="Android2.3上开启U盘自扫描"></a>Android2.3上开启U盘自扫描</h3><p>现象；</p>
<p>插入U盘后在播放器中看不到U盘文件，如何才能打开</p>
<p>解决方法：</p>
<p>需修改<br>frameworks\base\core\java\android\provider\Settings.java<br>frameworks\base\packages\SettingsProvider\src\com\android\providers\settings\DatabaseHelper.java<br>packages\providers\MediaProvider\src\com\android\providers\media\MediaScannerReceiver.java<br>packages\providers\MediaProvider\src\com\android\providers\media\MediaScannerService.java</p>
<p>具体修改如若无法完成，可参考相关补丁包—-补丁呢!!!</p>
<h3 id="如何降低CPU最高频率"><a href="#如何降低CPU最高频率" class="headerlink" title="如何降低CPU最高频率"></a>如何降低CPU最高频率</h3><p>现象：</p>
<p>目前系统为动态调频，如何限定最高CPU频率</p>
<p>解决方法：</p>
<p>降低CPU频率需要作以下两个修改：</p>
<ol>
<li><p>在lichee\tools\pack\chips\sun5i\configs\android\xxx\sys_config1.fex文件(“xxx”为对应的方案配置文件目录)中修改启动频率：</p>
<pre><code>[target]boot_clock =1008
</code></pre><p> boot_clock为启动的CPU频率，单位为MHz，根据需要自行修改，该值不能大于最高频率；</p>
</li>
<li><p>在lichee\linux-3.0\arch\arm\mach-sun4i\cpu-freq\cpu-freq.h文件中修改CPU的最高频率：</p>
<pre><code> #define SUN4I_CPUFREQ_MAX       (1008000000)
SUN4I_CPUFREQ_MAX为CPU允许运行的最高频率，单位是Hz，根据需要自行修改；
</code></pre></li>
</ol>
<h3 id="修改sys-config-fex，不升级整个固件，就使其生效"><a href="#修改sys-config-fex，不升级整个固件，就使其生效" class="headerlink" title="修改sys_config.fex，不升级整个固件，就使其生效"></a>修改sys_config.fex，不升级整个固件，就使其生效</h3><ol>
<li>在android shell中将/dev/block/nanda mount到某个节点:<br> mount -t vfat /dev/block/nanda /mnt/nand</li>
<li>修改sys_config1后build固件，然后在lichee\tools\pack\out\bootfs下找到scrpt.bin和script0.bin</li>
<li>然后用adb连接后，将scritp.bin和script0.bin推到所mount节点的根目录下，替换原有同名文件:<br> adb push script*.bin  /mnt/nand/</li>
<li>最后sync重启即可<br> adb shell<br> sync<br> reboot</li>
</ol>
<h3 id="修改浏览器默认浏览模式"><a href="#修改浏览器默认浏览模式" class="headerlink" title="修改浏览器默认浏览模式"></a>修改浏览器默认浏览模式</h3><p>在android4.0.1/packages/apps/Browser/res/xml/debug_preferences.xml中将</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ListPreference</span></span><br><span class="line">         <span class="attr">android:key</span>=<span class="string">"user_agent"</span></span><br><span class="line">         <span class="attr">android:title</span>=<span class="string">"@string/pref_development_uastring"</span></span><br><span class="line">         <span class="attr">android:entries</span>=<span class="string">"@array/pref_development_ua_choices"</span></span><br><span class="line">         <span class="attr">android:entryValues</span>=<span class="string">"@array/pref_development_ua_values"</span></span><br><span class="line">         <span class="attr">android:defaultValue</span>=<span class="string">"3"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>中修改defaultValue的值,对应如下:<br>Android  :0<br>Desktop :1<br>iPhone:2<br>iPad :3<br>Froyo-N1:4<br>Honeycomb-Xoom:5</p>
<h3 id="电源管理不准以及低电不关机"><a href="#电源管理不准以及低电不关机" class="headerlink" title="电源管理不准以及低电不关机"></a>电源管理不准以及低电不关机</h3><p>现象：</p>
<p>v1.0和v1.1中感觉电池电量不准，在低电情况下，系统也没有自动关机</p>
<p>解决方法：</p>
<p>需确认sys_config1.fex以下几个地方：</p>
<ol>
<li>pmu_battery_rdc的值为100</li>
<li>pmu_battery_cap为正确的电池电量</li>
<li>pmu_bat_para的放电曲线校正</li>
</ol>
<p>对于低电系统没有自动关机问题，一般尝试修改pmu_battery_cap：<br>pmu_bat_para4            = 0<br>pmu_bat_para5            = 5</p>
<h3 id="如何单独替换内核"><a href="#如何单独替换内核" class="headerlink" title="如何单独替换内核"></a>如何单独替换内核</h3><p>现象：</p>
<p>有没有办法不升级整个固件，单独替换内核</p>
<p>解决方法：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">在android shell中将/dev/block/nanda mount到某个节点:</span><br><span class="line">mount -t vfat /dev/block/nanda /mnt/nand</span><br><span class="line">然后用adb连接后，将bImage直接push到所mount节点的linux目录下，替换bImage:</span><br><span class="line">adb push bImage /mnt/nand/linux</span><br><span class="line">最后sync重启即可</span><br><span class="line">adb shell</span><br><span class="line">sync</span><br><span class="line">reboot</span><br></pre></td></tr></table></figure>
<h3 id="摄像头Zoom功能生效"><a href="#摄像头Zoom功能生效" class="headerlink" title="摄像头Zoom功能生效"></a>摄像头Zoom功能生效</h3><p>修改packages/apps/Camera/src/com/android/camera/ui/IndicatorControlWheel.java</p>
<p>dispatchTouchEvent函数，第269行</p>
<p>if ((mZoomControl != null) &amp;&amp; (index == 0)) {   </p>
<p>改为</p>
<p>if ((mZoomControl != null) &amp;&amp; (index == 0) &amp;&amp; mCurrentLevel == 0) {</p>
<h3 id="录象时不能选择分辨率"><a href="#录象时不能选择分辨率" class="headerlink" title="录象时不能选择分辨率"></a>录象时不能选择分辨率</h3><p>现象：</p>
<p>摄像头录像时，选择分辨率的选项没有</p>
<p>解决实例：</p>
<p>如果想在720p和480p之间选择，在mediaprofile.xml文件中，按如下设置：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">CamcorderProfiles</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">EncoderProfile</span> <span class="attr">quality</span>=<span class="string">"720p"</span> <span class="attr">fileFormat</span>=<span class="string">"mp4"</span> <span class="attr">duration</span>=<span class="string">"30"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Video</span> <span class="attr">codec</span>=<span class="string">"h264"</span></span><br><span class="line">                   <span class="attr">bitRate</span>=<span class="string">"3000000"</span></span><br><span class="line">                   <span class="attr">width</span>=<span class="string">"1280"</span></span><br><span class="line">                   <span class="attr">height</span>=<span class="string">"720"</span></span><br><span class="line">                   <span class="attr">frameRate</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">            </span><br><span class="line">            <span class="tag">&lt;<span class="name">Audio</span> <span class="attr">codec</span>=<span class="string">"aac"</span></span><br><span class="line">                   <span class="attr">bitRate</span>=<span class="string">"128000"</span></span><br><span class="line">                   <span class="attr">sampleRate</span>=<span class="string">"44100"</span></span><br><span class="line">                   <span class="attr">channels</span>=<span class="string">"2"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">EncoderProfile</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">        <span class="tag">&lt;<span class="name">EncoderProfile</span> <span class="attr">quality</span>=<span class="string">"480p"</span> <span class="attr">fileFormat</span>=<span class="string">"mp4"</span> <span class="attr">duration</span>=<span class="string">"30"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Video</span> <span class="attr">codec</span>=<span class="string">"h264"</span></span><br><span class="line">                   <span class="attr">bitRate</span>=<span class="string">"1500000"</span></span><br><span class="line">                   <span class="attr">width</span>=<span class="string">"640"</span></span><br><span class="line">                   <span class="attr">height</span>=<span class="string">"480"</span></span><br><span class="line">                   <span class="attr">frameRate</span>=<span class="string">"25"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Audio</span> <span class="attr">codec</span>=<span class="string">"aac"</span></span><br><span class="line">                   <span class="attr">bitRate</span>=<span class="string">"12200"</span></span><br><span class="line">                   <span class="attr">sampleRate</span>=<span class="string">"8000"</span></span><br><span class="line">                   <span class="attr">channels</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">EncoderProfile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">EncoderProfile</span> <span class="attr">quality</span>=<span class="string">"timelapse720p"</span> <span class="attr">fileFormat</span>=<span class="string">"mp4"</span> <span class="attr">duration</span>=<span class="string">"30"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Video</span> <span class="attr">codec</span>=<span class="string">"h264"</span></span><br><span class="line">                   <span class="attr">bitRate</span>=<span class="string">"3000000"</span></span><br><span class="line">                   <span class="attr">width</span>=<span class="string">"1280"</span></span><br><span class="line">                   <span class="attr">height</span>=<span class="string">"720"</span></span><br><span class="line">                   <span class="attr">frameRate</span>=<span class="string">"30"</span> /&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- audio setting is ignored --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Audio</span> <span class="attr">codec</span>=<span class="string">"aac"</span></span><br><span class="line">                   <span class="attr">bitRate</span>=<span class="string">"128000"</span></span><br><span class="line">                   <span class="attr">sampleRate</span>=<span class="string">"44100"</span></span><br><span class="line">                   <span class="attr">channels</span>=<span class="string">"2"</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">EncoderProfile</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">      <span class="tag">&lt;<span class="name">EncoderProfile</span> <span class="attr">quality</span>=<span class="string">"timelapse480p"</span> <span class="attr">fileFormat</span>=<span class="string">"mp4"</span> <span class="attr">duration</span>=<span class="string">"30"</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Video</span> <span class="attr">codec</span>=<span class="string">"h264"</span></span><br><span class="line">                   <span class="attr">bitRate</span>=<span class="string">"1500000"</span></span><br><span class="line">                   <span class="attr">width</span>=<span class="string">"640"</span></span><br><span class="line">                   <span class="attr">height</span>=<span class="string">"480"</span></span><br><span class="line">                   <span class="attr">frameRate</span>=<span class="string">"25"</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Audio</span> <span class="attr">codec</span>=<span class="string">"aac"</span></span><br><span class="line">                   <span class="attr">bitRate</span>=<span class="string">"12200"</span></span><br><span class="line">                   <span class="attr">sampleRate</span>=<span class="string">"8000"</span></span><br><span class="line">                   <span class="attr">channels</span>=<span class="string">"1"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">EncoderProfile</span>&gt;</span> </span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageEncoding</span> <span class="attr">quality</span>=<span class="string">"90"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageEncoding</span> <span class="attr">quality</span>=<span class="string">"80"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageEncoding</span> <span class="attr">quality</span>=<span class="string">"70"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">ImageDecoding</span> <span class="attr">memCap</span>=<span class="string">"20000000"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Camera</span> <span class="attr">previewFrameRate</span>=<span class="string">"0"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">CamcorderProfiles</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="修改蓝牙名称"><a href="#修改蓝牙名称" class="headerlink" title="修改蓝牙名称"></a>修改蓝牙名称</h3><p>如果你想修改默认的名字，可以这么做：<br>文件external/bluetooth/bluez/src/main.c<br>将main_opts.name  = g_strdup(“BlueZ”);里面的BlueZ换成你想要的名字即可！</p>
<h3 id="为何用UsbManager调用getDeviceList获取设备列表总是空的"><a href="#为何用UsbManager调用getDeviceList获取设备列表总是空的" class="headerlink" title="为何用UsbManager调用getDeviceList获取设备列表总是空的"></a>为何用UsbManager调用getDeviceList获取设备列表总是空的</h3><p>这个是因为缺少android.hardware.usb.host权限，</p>
<p><a href="http://www.oschina.net/code/download_src?file=android-4.0.1%2Fdata%2Fetc%2Fandroid.hardware.usb.host.xml" target="_blank" rel="external">http://www.oschina.net/code/download_src?file=android-4.0.1%2Fdata%2Fetc%2Fandroid.hardware.usb.host.xml</a></p>
<p>下载该文件，放在/system/etc/permisson/下，可以解决</p>
<h3 id="低电自动关机重启"><a href="#低电自动关机重启" class="headerlink" title="低电自动关机重启"></a>低电自动关机重启</h3><p>现象：</p>
<p>低电状态下，自动关机后重启，进不了系统，偶尔能进入系统但是触屏没反应。</p>
<p>解决方法：</p>
<p>原因在于源不足以支持系统开机，而此时电池又电量太低，导致不能满足整个系统的开机功耗。解决方法是提高开机的门限电和Android关机门限。</p>
<ol>
<li><p>boot阶段开机的门限电压设置方法 ：<br>在sys_config1脚本中<br>[boot_extend]<br>vol_threshold = 3500</p>
</li>
<li><p>修改Android 低电关机的门限</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">BatteryService.<span class="function">java </span><br><span class="line">     <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title">shutdownIfNoPower</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">// shut down gracefully if our battery is critically low and we are not powered.</span></span><br><span class="line">        <span class="comment">// wait until the system has booted before attempting to display the shutdown dialog.</span></span><br><span class="line">        <span class="keyword">if</span> (mBatteryLevel &lt; <span class="number">5</span> &amp;&amp; （<span class="number">5</span>为<span class="number">5</span>%即可关机修改 为更大的值，具体值可以根据具体情况而定）</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="修改鼠标的按键定义"><a href="#修改鼠标的按键定义" class="headerlink" title="修改鼠标的按键定义"></a>修改鼠标的按键定义</h3><p>现象：</p>
<p>鼠标插上以后，左键和右键的功能都是左键的，如何将右键修改为返回</p>
<p>解决方法：</p>
<p>这个是android的标准做法，如果定制，可以修改frameworks/base/services/input/inputreader.cpp文件中的：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">uint32_t</span> CursorButtonAccumulator::getButtonState() <span class="keyword">const</span> &#123;</span><br><span class="line">    <span class="keyword">uint32_t</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (mBtnLeft) &#123;</span><br><span class="line">        result |= AMOTION_EVENT_BUTTON_PRIMARY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mBtnRight) &#123;</span><br><span class="line">        result |= AMOTION_EVENT_BUTTON_SECONDARY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mBtnMiddle) &#123;</span><br><span class="line">        result |= AMOTION_EVENT_BUTTON_TERTIARY;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mBtnBack || mBtnSide) &#123;</span><br><span class="line">        result |= AMOTION_EVENT_BUTTON_BACK;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (mBtnForward || mBtnExtra) &#123;</span><br><span class="line">        result |= AMOTION_EVENT_BUTTON_FORWARD;</span><br><span class="line">    &#125;</span><br><span class="line">    return result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>目前因为下面函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">bool</span> <span class="title">isPointerDown</span><span class="params">(int32_t buttonState)</span> </span>&#123;</span><br><span class="line">    return buttonState &amp;</span><br><span class="line">            (AMOTION_EVENT_BUTTON_PRIMARY | AMOTION_EVENT_BUTTON_SECONDARY</span><br><span class="line">                    | AMOTION_EVENT_BUTTON_TERTIARY);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将鼠标左右键的功能设置成判断鼠标是否点击的操作，所以功能一致，如果需要修改，这需要改一下上面的getButtonState函数中的标志位即可，比如需要将右键改为后退键，只需要<br>函数中：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">if</span> (mBtnRight) &#123;</span><br><span class="line">        result |= AMOTION_EVENT_BUTTON_SECONDARY;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//改为</span></span><br><span class="line">  <span class="keyword">if</span> (mBtnRight) &#123;</span><br><span class="line">        result |= AMOTION_EVENT_BUTTON_BACK;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//即可</span></span><br></pre></td></tr></table></figure>
<h3 id="修改system分区大小"><a href="#修改system分区大小" class="headerlink" title="修改system分区大小"></a>修改system分区大小</h3><ol>
<li><p>修改sys_config.fex中的</p>
<figure class="highlight tex"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[partition3]</span><br><span class="line">class_name  = DISK</span><br><span class="line">name        = system</span><br><span class="line">size_hi     = 0</span><br><span class="line">size_lo     = 524288     //此处单位为K</span><br><span class="line">user_type   = 2</span><br><span class="line">ro            = 0</span><br></pre></td></tr></table></figure>
</li>
<li><p>修改device对应目录下的BoardConfig.mk中的<br> BOARD_SYSTEMIMAGE_PARTITION_SIZE := 536870912  //此处单位为byte</p>
</li>
</ol>
]]></content>
    </entry>
    
    <entry>
      <title><![CDATA[yii项目实践]]></title>
      <url>https://github.com/pkjueying/pkjueying.github.io/2012/11/18/Yii%E9%A1%B9%E7%9B%AE%E5%AE%9E%E8%B7%B5/</url>
      <content type="html"><![CDATA[<h3 id="分页"><a href="#分页" class="headerlink" title="分页"></a>分页</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$criteria = <span class="keyword">new</span> CDbCriteria();  </span><br><span class="line">$criteria-&gt;order = <span class="string">' ctimedesc'</span>;         <span class="comment">//按什么字段来排序  </span></span><br><span class="line">$count =NewsComments::model()-&gt;count($criteria);<span class="comment">//count()函数计算数组中的单元数目或对象中的属性个数。  </span></span><br><span class="line">$pager = <span class="keyword">new</span> CPagination($count);  </span><br><span class="line">$pager -&gt; pageSize =<span class="number">5</span>;                           <span class="comment">//每页显示的行数  </span></span><br><span class="line">$pager-&gt;applyLimit($criteria);  </span><br><span class="line">$newsCommentList =NewsComments::model()-&gt;findAll($criteria);<span class="comment">//查询所有的数据  </span></span><br><span class="line">  </span><br><span class="line">$this-&gt;render(<span class="string">'view'</span> , <span class="keyword">array</span>(  </span><br><span class="line">    <span class="string">'pages'</span>=&gt;$pager,  </span><br><span class="line">    <span class="string">'list'</span>=&gt;$newsCommentList,  </span><br><span class="line">  ));  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br><span class="line"><span class="comment">//然后在view视图中：  </span></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"> $this-&gt;widget(<span class="string">'CLinkPager'</span>,<span class="keyword">array</span>(  </span><br><span class="line">  <span class="string">'header'</span>=&gt;<span class="string">''</span>,  </span><br><span class="line">  <span class="string">'firstPageLabel'</span>=&gt;<span class="string">'首页'</span>,  </span><br><span class="line">  <span class="string">'lastPageLabel'</span>=&gt;<span class="string">'末页'</span>,  </span><br><span class="line">  <span class="string">'prevPageLabel'</span>=&gt;<span class="string">'上一页'</span>,  </span><br><span class="line">  <span class="string">'nextPageLabel'</span>=&gt;<span class="string">'下一页'</span>,  </span><br><span class="line">  <span class="string">'pages'</span>=&gt;$pages,  </span><br><span class="line">  <span class="string">'maxButtonCount'</span>=&gt;<span class="number">13</span>,  </span><br><span class="line"> ));  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="在时间段中查找相应数据"><a href="#在时间段中查找相应数据" class="headerlink" title="在时间段中查找相应数据"></a>在时间段中查找相应数据</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="comment">//在Models的search()函数中添加  </span></span><br><span class="line">$criteria-&gt;compare(<span class="string">'mtime'</span>,<span class="string">'&gt;='</span>.$this-&gt;ctime,<span class="keyword">true</span>);    </span><br><span class="line">$criteria-&gt;compare(<span class="string">'mtime'</span>,<span class="string">'&lt;='</span>.$this-&gt;mtime,<span class="keyword">true</span>);  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br><span class="line"><span class="comment">//例如与第三方时间控件进行整合时，在_search视图中使用代码如下：  </span></span><br><span class="line"> </span><br><span class="line"> <span class="meta">&lt;?php</span> <span class="keyword">echo</span> $form-&gt;label($model,<span class="string">'ctime'</span>);<span class="meta">?&gt;</span>  </span><br><span class="line"> <span class="meta">&lt;?php</span>  </span><br><span class="line">  $this-&gt;widget(<span class="string">'application.extensions.timepicker.timepicker'</span>,<span class="keyword">array</span>(  </span><br><span class="line">    <span class="string">'model'</span>=&gt;$model,  </span><br><span class="line">    <span class="string">'name'</span>=&gt;<span class="string">'ctime'</span>,  </span><br><span class="line">  ));  </span><br><span class="line"> <span class="meta">?&gt;</span>  </span><br><span class="line">  </span><br><span class="line"> <span class="meta">&lt;?php</span>  </span><br><span class="line">  $this-&gt;widget(<span class="string">'application.extensions.timepicker.timepicker'</span>,<span class="keyword">array</span>(  </span><br><span class="line">    <span class="string">'model'</span>=&gt;$model,  </span><br><span class="line">    <span class="string">'name'</span>=&gt;<span class="string">'mtime'</span>,  </span><br><span class="line">  ));  </span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="对查询的数据进行排序并显示"><a href="#对查询的数据进行排序并显示" class="headerlink" title="对查询的数据进行排序并显示"></a>对查询的数据进行排序并显示</h3><p>可以在Models的search()方法中添加如下代码:  </p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>&gt;  </span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> CActiveDataProvider(get_class($this), <span class="keyword">array</span>(  </span><br><span class="line">  <span class="string">'pagination'</span>=&gt;<span class="keyword">array</span>(  </span><br><span class="line">    <span class="string">'pageSize'</span>=&gt;<span class="number">20</span>,<span class="comment">//设置每页显示20条  </span></span><br><span class="line">  ),  </span><br><span class="line">  <span class="string">'sort'</span>=&gt;<span class="keyword">array</span>(  </span><br><span class="line">    <span class="string">'defaultOrder'</span>=&gt;<span class="string">'comment_idDESC'</span>, <span class="comment">//按指定的字段进行排序  </span></span><br><span class="line">  ),  </span><br><span class="line">  <span class="string">'criteria'</span>=&gt;$criteria,  </span><br><span class="line">));  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="在视图中显示非数据库表中的数据"><a href="#在视图中显示非数据库表中的数据" class="headerlink" title="在视图中显示非数据库表中的数据"></a>在视图中显示非数据库表中的数据</h3><p>//a.首先在视图中将对应的字段进行替换。如<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="comment">//   'status',  </span></span><br><span class="line"><span class="keyword">array</span>(  </span><br><span class="line">  <span class="string">'name'</span>=&gt;<span class="string">'status'</span>,  </span><br><span class="line">  <span class="string">'type'</span>=&gt;<span class="string">'raw'</span>,  </span><br><span class="line">  <span class="string">'value'</span>=&gt;<span class="keyword">array</span>($this,<span class="string">'showStatus'</span>)  </span><br><span class="line">),  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>//b.然后在对应的控制器中写相应的方法。如<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">showStatus</span><span class="params">($data, $row, $c)</span>  </span><br><span class="line"></span>&#123;  </span><br><span class="line"> <span class="keyword">switch</span> ($data-&gt;status)  </span><br><span class="line"> &#123;  </span><br><span class="line">  <span class="keyword">case</span> <span class="string">'ready'</span>:  </span><br><span class="line">   <span class="keyword">return</span><span class="string">'准备'</span>;  </span><br><span class="line">  <span class="keyword">case</span> <span class="string">'locked'</span>:  </span><br><span class="line">   <span class="keyword">return</span> <span class="string">'锁定'</span>;  </span><br><span class="line">  <span class="keyword">case</span> <span class="string">'open'</span>:  </span><br><span class="line">   <span class="keyword">return</span><span class="string">'打开'</span>;  </span><br><span class="line">  <span class="keyword">case</span> <span class="string">'removed'</span>:  </span><br><span class="line">   <span class="keyword">return</span><span class="string">'删除'</span>;  </span><br><span class="line"> &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="修改admin视图下默认的CButtonColumn"><a href="#修改admin视图下默认的CButtonColumn" class="headerlink" title="修改admin视图下默认的CButtonColumn"></a>修改admin视图下默认的CButtonColumn</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="keyword">array</span>(  </span><br><span class="line"> <span class="string">'class'</span>=&gt;<span class="string">'CButtonColumn'</span>,  </span><br><span class="line"> <span class="string">'template'</span>=&gt;<span class="string">'&#123;comment&#125; &#123;view&#125;&#123;update&#125; &#123;delete&#125;'</span>,  </span><br><span class="line"> <span class="string">'buttons'</span>=&gt;<span class="keyword">array</span>(  </span><br><span class="line">  <span class="string">'comment'</span> =&gt;<span class="keyword">array</span>(  </span><br><span class="line">   <span class="string">'label'</span>=&gt;<span class="string">'评论'</span>,  </span><br><span class="line">   <span class="string">'imageUrl'</span>=&gt;Yii::app()-&gt;request-&gt;baseUrl.<span class="string">'/images/icons/coins.png'</span>,  </span><br><span class="line">   <span class="string">'url'</span>=&gt;<span class="string">'Yii::app()-&gt;createUrl("newsComments/index",array("news_id"=&gt;$data-&gt;news_id, ))'</span>,<span class="comment">//始终使用$data来获取相关的数据。  </span></span><br><span class="line">  ),  </span><br><span class="line"> ),  </span><br><span class="line"> <span class="string">'htmlOptions'</span> =&gt; <span class="keyword">array</span>(  </span><br><span class="line">   <span class="string">'style'</span>=&gt;<span class="string">'width:100px'</span>,  </span><br><span class="line"> ),  </span><br><span class="line">),  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="ckfinder"><a href="#ckfinder" class="headerlink" title="ckfinder"></a>ckfinder</h3><p>需要调用ckfinder直接弹出上传文件的相关目录，以便可以选择特定的图片，并将该图片的相关地址存入文本框中。一般在_from视图中进行数据的创建以及更新时可以用到。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>src=<span class="string">"../pkjueying/ckfinder/ckfinder.js"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span>  </span><br><span class="line">&lt;script type=<span class="string">"text/javascript"</span>&gt;  </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">BrowseServer</span>(<span class="params">imgId</span>)  </span><br><span class="line"></span>&#123;  </span><br><span class="line"> <span class="keyword">var</span> finder = <span class="keyword">new</span> CKFinder() ;  </span><br><span class="line"> finder.basePath = <span class="string">'../pkjueying/ckfinder/'</span>;<span class="comment">//导入CKFinder的路径  </span></span><br><span class="line"> finder.selectActionFunction = SetFileField;<span class="comment">//设置文件被选中时的函数  </span></span><br><span class="line"> finder.selectActionData = imgId; <span class="comment">//接收地址的inputID  </span></span><br><span class="line"> finder.popup() ;  </span><br><span class="line">&#125;  </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">SetFileField</span>(<span class="params">fileUrl,data</span>)  </span><br><span class="line"></span>&#123;  </span><br><span class="line"> <span class="built_in">document</span>.getElementByIdx_x_x(data[<span class="string">"selectActionData"</span>]).value= fileUrl ;  </span><br><span class="line">&#125;  </span><br><span class="line">&lt;<span class="regexp">/script&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span>&gt;</span>  </span><br><span class="line"> <span class="php"><span class="meta">&lt;?php</span> <span class="keyword">echo</span>$form-&gt;labelEx($model,<span class="string">'editor_avatar'</span>);<span class="meta">?&gt;</span></span>  </span><br><span class="line"> <span class="php"><span class="meta">&lt;?php</span> <span class="keyword">echo</span>$form-&gt;textField($model ,<span class="string">'editor_avatar'</span> ,<span class="keyword">array</span>(<span class="string">'id'</span>=&gt;<span class="string">'editor_avatar'</span>, ));<span class="meta">?&gt;</span></span>  </span><br><span class="line"> <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"button"</span> <span class="attr">value</span>=<span class="string">" 浏 览 "</span><span class="attr">onclick</span>=<span class="string">"BrowseServer('editor_avatar');"</span> /&gt;</span>  </span><br><span class="line"> <span class="php"><span class="meta">&lt;?php</span> <span class="keyword">echo</span>$form-&gt;error($model,<span class="string">'editor_avatar'</span>);<span class="meta">?&gt;</span></span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span>  </span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">### 使用第三方ckeditor+ckfinder控件</span><br><span class="line"></span><br><span class="line">// 示例代码如下：  </span><br><span class="line">```php</span><br><span class="line"></span><br><span class="line"><span class="php"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="keyword">echo</span> $form-&gt;labelEx($model,<span class="string">'summary'</span>);  </span><br><span class="line">$form-&gt;widget(<span class="string">'application.extensions.editor.CKkceditor'</span>,<span class="keyword">array</span>(  </span><br><span class="line">  <span class="string">"model"</span> =&gt;$model, <span class="comment">// 数据模型  </span></span><br><span class="line">  <span class="string">"attribute"</span> =&gt;<span class="string">'summary'</span>, <span class="comment">// 文本域中的字段，也就是之前文本域的名字  </span></span><br><span class="line">  <span class="string">"height"</span> =&gt;<span class="string">'200px'</span>, <span class="comment">// 编辑器的高度  </span></span><br><span class="line">  <span class="string">"width"</span> =&gt;<span class="string">'80%'</span>,         <span class="comment">//编辑器的宽度  </span></span><br><span class="line">  <span class="string">"filespath"</span>=&gt;SITE_PATH.<span class="string">"www/data/upload"</span>,  </span><br><span class="line">  <span class="string">"filesurl"</span>=&gt;Yii::app()-&gt;baseUrl.<span class="string">"/data/upload"</span>,  </span><br><span class="line">  )  </span><br><span class="line">);  </span><br><span class="line"><span class="keyword">echo</span> $form-&gt;error($model,<span class="string">'summary'</span>);  </span><br><span class="line"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>
<h3 id="由数据库表生成所需的代码"><a href="#由数据库表生成所需的代码" class="headerlink" title="由数据库表生成所需的代码"></a>由数据库表生成所需的代码</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="string">'modules'</span> =&gt;   <span class="keyword">array</span>(  </span><br><span class="line"> <span class="string">'gii'</span>=&gt;<span class="keyword">array</span>(  </span><br><span class="line">  <span class="string">'class'</span>=&gt;<span class="string">'system.gii.GiiModule'</span>,  </span><br><span class="line">  <span class="string">'password'</span>=&gt;<span class="string">'pkjueying'</span>,  </span><br><span class="line">  <span class="comment">// If removed, Gii defaults tolocalhost only. Edit carefully to taste.  </span></span><br><span class="line">  <span class="string">'ipFilters'</span>=&gt;<span class="keyword">array</span>(<span class="string">'10.10.16.43'</span>,<span class="string">'10.10.16.18'</span>,<span class="string">'10.10.16.47'</span>,<span class="string">'::1'</span>),  </span><br><span class="line"> ),  </span><br><span class="line">),  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="由Yii生成静态页面"><a href="#由Yii生成静态页面" class="headerlink" title="由Yii生成静态页面"></a>由Yii生成静态页面</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="comment">//在action函数中修改函数的参数，添加第三个参数，设置为true.思路如下：  </span></span><br><span class="line">$out_file = $this-&gt;render($view,$data,<span class="keyword">true</span>);  </span><br><span class="line">save_to_html($path, $out_file);<span class="comment">//此函数仅仅是示例，具体实现自己写。把$out_file存到指定目录，自己命名  </span></span><br><span class="line"><span class="keyword">unset</span>($outFile);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="yii的controller中外挂action"><a href="#yii的controller中外挂action" class="headerlink" title="yii的controller中外挂action"></a>yii的controller中外挂action</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UpdateAction</span> <span class="keyword">extends</span> <span class="title">CAction</span> </span>&#123;   </span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">run</span><span class="params">()</span> </span>&#123;   </span><br><span class="line"> <span class="comment">// place the action logichere   </span></span><br><span class="line">  &#125;   </span><br><span class="line">&#125;  </span><br><span class="line">  </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">PostController</span> <span class="keyword">extends</span> <span class="title">CController</span></span>&#123;   </span><br><span class="line">  <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">actions</span><span class="params">()</span></span>&#123;   </span><br><span class="line"> <span class="keyword">return</span> <span class="keyword">array</span>(<span class="string">'edit'</span>=&gt;<span class="string">'application.controllers.post.UpdateAction'</span>,);   </span><br><span class="line">  &#125;   </span><br><span class="line">  ....  </span><br><span class="line">&#125;   </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="如何使用theme"><a href="#如何使用theme" class="headerlink" title="如何使用theme"></a>如何使用theme</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="comment">//在main.php 里面配置  </span></span><br><span class="line"><span class="keyword">return</span> <span class="keyword">array</span>(  </span><br><span class="line">  <span class="string">'theme'</span>=&gt;<span class="string">'basic'</span>,  </span><br><span class="line">  <span class="comment">//......  </span></span><br><span class="line">);  </span><br><span class="line"><span class="comment">//要使用theme里面的资源的话，比如说images, js, css, 应该这样，  </span></span><br><span class="line">Yii::app()-&gt;theme-&gt;baseUrl.”/images/FileName.gif”  </span><br><span class="line">Yii::app()-&gt;Theme-&gt;baseUrl.”/css/<span class="keyword">default</span>/common.css”  </span><br><span class="line">  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="在当前页面注册css和js文件"><a href="#在当前页面注册css和js文件" class="headerlink" title="在当前页面注册css和js文件"></a>在当前页面注册css和js文件</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"> $cs=Yii::app()-&gt;clientScript;  </span><br><span class="line"> $cs-&gt;registerCssFile($cssFile);  </span><br><span class="line"> $cs-&gt;registerScriptFile($jsFile);  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="使用widget方式。"><a href="#使用widget方式。" class="headerlink" title="使用widget方式。"></a>使用widget方式。</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"> </span><br><span class="line"><span class="comment">//a.显示详细信息  </span></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$this-&gt;widget(<span class="string">'zii.widgets.CDetailView'</span>,<span class="keyword">array</span>(   </span><br><span class="line">    <span class="string">'data'</span>=&gt; $model,   </span><br><span class="line">    <span class="string">'attributes'</span>=&gt; <span class="keyword">array</span>(   </span><br><span class="line">       <span class="string">'id'</span>,   </span><br><span class="line">       <span class="string">'title'</span>,   </span><br><span class="line">       <span class="string">'content'</span>,   </span><br><span class="line">   ),   </span><br><span class="line">);  </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br><span class="line"></span><br><span class="line"><span class="comment">//b.显示列表，可以进行条件限制和分页  </span></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"><span class="comment">//controller中  </span></span><br><span class="line">$dataProvider = <span class="keyword">new</span> CActiveDataProvider(<span class="string">'Post'</span>,<span class="keyword">array</span>(   </span><br><span class="line">    <span class="string">'criteria'</span>=&gt; <span class="keyword">array</span>(   </span><br><span class="line">           <span class="string">'condition'</span> =&gt; <span class="string">'project_id =:project_id'</span>,   </span><br><span class="line">           <span class="string">'params'</span> =&gt; <span class="keyword">array</span>(<span class="string">':project_id'</span> =&gt;$pid),   </span><br><span class="line">       ),   </span><br><span class="line">    <span class="string">'pagination'</span>=&gt; <span class="keyword">array</span>(   </span><br><span class="line">       <span class="string">'pageSize'</span> =&gt; <span class="string">'5'</span>,   </span><br><span class="line">   ),   </span><br><span class="line">));  </span><br><span class="line"><span class="comment">//视图中  </span></span><br><span class="line">$this-&gt;widget(<span class="string">'zii.widgets.CListView'</span>,<span class="keyword">array</span>(   </span><br><span class="line"> <span class="string">'dataProvider'</span> =&gt; $dataProvider,<span class="comment">//数据源   </span></span><br><span class="line"> <span class="string">'itemView'</span> =&gt; <span class="string">'_view'</span>,<span class="comment">//渲染子视图，传给模板的值用$data接收。   </span></span><br><span class="line"> ),   </span><br><span class="line">);   </span><br><span class="line"><span class="meta">?&gt;</span>  </span><br><span class="line">  </span><br><span class="line"><span class="comment">//c.显示列表，但是结果会在表格中显示  </span></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">   $this-&gt;widget(<span class="string">'zii.widgets.grid.CGridView'</span>,<span class="keyword">array</span>(   </span><br><span class="line">       <span class="string">'dataProvider'</span>=&gt;$dataProvider,<span class="comment">//数据源   </span></span><br><span class="line">       <span class="string">'columns'</span>=&gt;<span class="keyword">array</span>(   </span><br><span class="line">           <span class="string">'title'</span>,         <span class="comment">// display the 'title' attribute   </span></span><br><span class="line">           <span class="string">'category.name'</span>,  <span class="comment">// display the 'name' attributeof the 'category' relation//显示与category相关的name   </span></span><br><span class="line">           <span class="string">'content:html'</span>,   <span class="comment">// display the'content' attribute as purified HTML显示净化过的HTML格式   </span></span><br><span class="line">           <span class="keyword">array</span>(           <span class="comment">// display 'create_time' using anexpression   </span></span><br><span class="line">               <span class="string">'name'</span>=&gt;<span class="string">'create_time'</span>,   </span><br><span class="line">               <span class="string">'value'</span>=&gt;<span class="string">'date("M j, Y",$data-&gt;create_time)'</span>,   </span><br><span class="line">           ),   </span><br><span class="line">           <span class="keyword">array</span>(           <span class="comment">// display 'author.username' using anexpression   </span></span><br><span class="line">               <span class="string">'name'</span>=&gt;<span class="string">'authorName'</span>,   </span><br><span class="line">               <span class="string">'value'</span>=&gt;<span class="string">'$data-&gt;author-&gt;username'</span>,   </span><br><span class="line">           ),   </span><br><span class="line">   <span class="keyword">array</span>(   <span class="comment">//display the 'status' attribute of controller's functionshowStatus($data, $row, $c)  </span></span><br><span class="line">    <span class="string">'name'</span>=&gt;<span class="string">'status'</span>,  </span><br><span class="line">    <span class="string">'type'</span>=&gt;<span class="string">'raw'</span>,  </span><br><span class="line">    <span class="string">'value'</span>=&gt;<span class="keyword">array</span>($this,<span class="string">'showStatus'</span>)  </span><br><span class="line">   ),  </span><br><span class="line">           <span class="keyword">array</span>(           <span class="comment">// display a column with "view", "update" and "delete"buttons   </span></span><br><span class="line">               <span class="string">'class'</span>=&gt;<span class="string">'CButtonColumn'</span>,   </span><br><span class="line">           ),   </span><br><span class="line">       ),   </span><br><span class="line">       <span class="string">'filter'</span>=&gt;$model,<span class="comment">//对用户的输入进行过滤   </span></span><br><span class="line">   ));   </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="urlManager的配置"><a href="#urlManager的配置" class="headerlink" title="urlManager的配置"></a>urlManager的配置</h3><p>//a.apache下：在config/main.php的components节点下增加：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"> <span class="string">'urlManager'</span>=&gt;<span class="keyword">array</span>(  </span><br><span class="line">  <span class="string">'urlFormat'</span>=&gt;<span class="string">'path'</span>,        </span><br><span class="line">  <span class="string">'rules'</span>=&gt;<span class="keyword">array</span>(  </span><br><span class="line">   <span class="string">'&lt;controller:\w+&gt;/&lt;id:\d+&gt;'</span>=&gt;<span class="string">'&lt;controller&gt;/view'</span>,  </span><br><span class="line">   <span class="string">'&lt;controller:\w+&gt;/&lt;action:\w+&gt;/&lt;id:\d+&gt;'</span>=&gt;<span class="string">'&lt;controller&gt;/&lt;action&gt;'</span>,  </span><br><span class="line">   <span class="string">'&lt;controller:\w+&gt;/&lt;action:\w+&gt;'</span>=&gt;<span class="string">'&lt;controller&gt;/&lt;action&gt;'</span>,  </span><br><span class="line">  ),  </span><br><span class="line"> ),  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>//b.apache配置：  </p>
<p>在app的根目录(项目目录，同入口index.php)创建.htaccess文件。内容如下：  </p>
<p>Options +FollowSymLinks<br>IndexIgnore <em>/</em><br>RewriteEngine on<br># if a directory or a file exists, use it directly<br>RewriteCond %{REQUEST_FILENAME} !-f<br>RewriteCond %{REQUEST_FILENAME} !-d<br># otherwise forward it to index.php<br>RewriteRule . index.php  </p>
<p>//c.nginx下的配置<br>//在config/main.php的components节点下增加：<br><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"> <span class="string">'urlManager'</span>=&gt;<span class="keyword">array</span>(  </span><br><span class="line">  <span class="string">'urlFormat'</span>=&gt;<span class="string">'path'</span>,        </span><br><span class="line">  <span class="string">'rules'</span>=&gt;<span class="keyword">array</span>(  </span><br><span class="line">   <span class="string">'&lt;controller:\w+&gt;/&lt;id:\d+&gt;'</span>=&gt;<span class="string">'&lt;controller&gt;/view'</span>,  </span><br><span class="line">   <span class="string">'&lt;controller:\w+&gt;/&lt;action:\w+&gt;/&lt;id:\d+&gt;'</span>=&gt;<span class="string">'&lt;controller&gt;/&lt;action&gt;'</span>,  </span><br><span class="line">   <span class="string">'&lt;controller:\w+&gt;/&lt;action:\w+&gt;'</span>=&gt;<span class="string">'&lt;controller&gt;/&lt;action&gt;'</span>,  </span><br><span class="line">  ),  </span><br><span class="line"> ),  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>//step2：<br>//在nginx.conf的server 段添加:<br>location / {<br>    if (!-e$request_filename){<br>       rewrite ^/(.*) /index.php last;<br>   }<br>}  </p>
]]></content>
    </entry>
    
  
  
</search>
